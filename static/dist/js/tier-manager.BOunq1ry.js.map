{"version":3,"file":"tier-manager.BOunq1ry.js","sources":["../../js/tier-manager.js"],"sourcesContent":["/**\n * Tier Management Module\n * Handles tier badge display, upgrade modals, and feature gating\n * \n * Converted to ES6 module - maintains backward compatibility via window attachment\n */\n\nimport { ENDPOINTS, STORAGE_KEYS, TIERS, TIER_DISPLAY_NAMES } from './constants.js';\nimport { getAuthToken, hasAuthToken, getAuthHeaders } from './auth-helpers.ts';\n\n/**\n * Feature access map - which tiers can access which features\n */\nexport const FEATURE_ACCESS_MAP = {\n    'api_keys': [TIERS.PRO, TIERS.CUSTOM],\n    'location_filters': [TIERS.PAYG, TIERS.PRO, TIERS.CUSTOM],\n    'isp_filter': [TIERS.PAYG, TIERS.PRO, TIERS.CUSTOM],\n    'affiliate_program': [TIERS.PRO, TIERS.CUSTOM],\n    'bulk_discounts': [TIERS.PRO, TIERS.CUSTOM],\n    'priority_support': [TIERS.PRO, TIERS.CUSTOM],\n    'custom_branding': [TIERS.CUSTOM],\n    'dedicated_support': [TIERS.CUSTOM]\n};\n\n/**\n * Feature display names\n */\nexport const FEATURE_NAMES = {\n    'api_keys': 'API Keys',\n    'location_filters': 'Location Filters',\n    'isp_filter': 'ISP/Carrier Filtering',\n    'affiliate_program': 'Affiliate Program',\n    'bulk_discounts': 'Bulk Purchase Discounts',\n    'priority_support': 'Priority Support',\n    'custom_branding': 'Custom Branding',\n    'dedicated_support': 'Dedicated Support'\n};\n\n/**\n * TierManager class - manages tier display and feature gating\n */\nexport class TierManager {\n    constructor(options = {}) {\n        this.currentTier = null;\n        this.tierConfig = null;\n        this.autoInit = options.autoInit !== false;\n\n        if (this.autoInit) {\n            this.init();\n        }\n    }\n\n    async init() {\n        await this.loadCurrentTier();\n        this.renderTierBadge();\n        this.setupEventListeners();\n    }\n\n    async loadCurrentTier() {\n        try {\n            if (!hasAuthToken()) return;\n\n            const response = await fetch(ENDPOINTS.TIERS.CURRENT, {\n                headers: getAuthHeaders(),\n                credentials: 'include'\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                this.currentTier = data.current_tier;\n                this.tierConfig = data;\n            }\n        } catch (error) {\n            this._log('error', 'Failed to load tier:', error);\n        }\n    }\n\n    renderTierBadge() {\n        const headerRight = document.querySelector('.header-right');\n        if (!headerRight || !this.currentTier) return;\n\n        // Remove existing badge if present\n        const existingBadge = headerRight.querySelector('.tier-badge-container');\n        if (existingBadge) existingBadge.remove();\n\n        const badgeContainer = document.createElement('div');\n        badgeContainer.className = 'tier-badge-container';\n        badgeContainer.innerHTML = `\n            <span class=\"tier-badge tier-badge-${this.currentTier}\" aria-label=\"Current plan: ${this.getTierDisplayName()}\">\n                <i class=\"ph ph-crown\" aria-hidden=\"true\"></i>\n                ${this.getTierDisplayName()}\n            </span>\n            ${this.currentTier === TIERS.FREEMIUM ? '<a href=\"/pricing\" class=\"upgrade-link\" aria-label=\"Upgrade your plan\">Upgrade</a>' : ''}\n        `;\n\n        const balanceDisplay = headerRight.querySelector('.balance-display');\n        if (balanceDisplay) {\n            headerRight.insertBefore(badgeContainer, balanceDisplay);\n        } else {\n            headerRight.appendChild(badgeContainer);\n        }\n    }\n\n    getTierDisplayName() {\n        return TIER_DISPLAY_NAMES[this.currentTier] || 'Free';\n    }\n\n    setupEventListeners() {\n        // Listen for 402 errors (Payment Required)\n        window.addEventListener('fetch-error-402', (e) => {\n            this.showUpgradeModal(e.detail);\n        });\n\n        // Listen for escape key to close modal\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                this.closeUpgradeModal();\n            }\n        });\n    }\n\n    showUpgradeModal(details = {}) {\n        const requiredTier = details.required_tier || TIERS.PAYG;\n        const feature = details.feature || 'this feature';\n        const message = details.message || `${feature} requires ${requiredTier} tier`;\n\n        // Remove existing modal if present\n        this.closeUpgradeModal();\n\n        const modal = document.createElement('div');\n        modal.className = 'upgrade-modal-overlay active';\n        modal.setAttribute('role', 'dialog');\n        modal.setAttribute('aria-modal', 'true');\n        modal.setAttribute('aria-labelledby', 'upgrade-modal-title');\n        modal.innerHTML = `\n            <div class=\"upgrade-modal\">\n                <div class=\"upgrade-modal-header\">\n                    <i class=\"ph ph-lock feature-locked-icon\" aria-hidden=\"true\"></i>\n                    <h2 id=\"upgrade-modal-title\">Upgrade Required</h2>\n                    <p>${this._escapeHtml(message)}</p>\n                </div>\n\n                <div class=\"tier-comparison-box\">\n                    <div class=\"tier-row\">\n                        <span class=\"tier-label\">Your Plan</span>\n                        <span class=\"tier-value locked\">\n                            <i class=\"ph ph-x\" aria-hidden=\"true\"></i>\n                            ${this.getTierDisplayName()}\n                        </span>\n                    </div>\n                    <div class=\"tier-row\">\n                        <span class=\"tier-label\">Required Plan</span>\n                        <span class=\"tier-value unlocked\">\n                            <i class=\"ph ph-check\" aria-hidden=\"true\"></i>\n                            ${this._capitalize(requiredTier)}\n                        </span>\n                    </div>\n                    ${this._getFeatureComparison(requiredTier)}\n                </div>\n\n                <div class=\"upgrade-cta-buttons\">\n                    <button class=\"btn-upgrade btn-upgrade-secondary\" data-action=\"close\" aria-label=\"Close upgrade modal\">\n                        Maybe Later\n                    </button>\n                    <button class=\"btn-upgrade btn-upgrade-primary\" data-action=\"upgrade\" data-tier=\"${requiredTier}\" aria-label=\"Upgrade to ${requiredTier} plan\">\n                        Upgrade to ${this._capitalize(requiredTier)}\n                    </button>\n                </div>\n            </div>\n        `;\n\n        document.body.appendChild(modal);\n\n        // Event delegation for buttons\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) {\n                this.closeUpgradeModal();\n            }\n\n            const action = e.target.dataset.action;\n            if (action === 'close') {\n                this.closeUpgradeModal();\n            } else if (action === 'upgrade') {\n                this.upgradeTo(e.target.dataset.tier);\n            }\n        });\n\n        // Focus trap\n        const firstButton = modal.querySelector('button');\n        if (firstButton) firstButton.focus();\n    }\n\n    _getFeatureComparison(targetTier) {\n        const features = {\n            [TIERS.PAYG]: [\n                { name: 'Location Filters', current: false, target: true },\n                { name: 'ISP Filters', current: false, target: true },\n                { name: 'Custom Balance', current: false, target: true }\n            ],\n            [TIERS.PRO]: [\n                { name: 'API Access', current: this.currentTier !== TIERS.FREEMIUM, target: true },\n                { name: 'All Filters Included', current: false, target: true },\n                { name: 'API Keys', current: '0', target: '10' },\n                { name: 'Affiliate Program', current: false, target: true }\n            ],\n            [TIERS.CUSTOM]: [\n                { name: 'API Access', current: this.currentTier === TIERS.PRO, target: true },\n                { name: 'Unlimited API Keys', current: false, target: true },\n                { name: 'Enhanced Affiliate', current: false, target: true },\n                { name: 'Dedicated Support', current: false, target: true }\n            ]\n        };\n\n        const featureList = features[targetTier] || features[TIERS.PAYG];\n        return featureList.map(f => `\n            <div class=\"tier-row\">\n                <span class=\"tier-label\">${f.name}</span>\n                <div style=\"display: flex; gap: 20px;\">\n                    <span class=\"tier-value ${f.current ? 'unlocked' : 'locked'}\">\n                        ${f.current || '✗'}\n                    </span>\n                    <span aria-hidden=\"true\">→</span>\n                    <span class=\"tier-value unlocked\">\n                        ${f.target || '✓'}\n                    </span>\n                </div>\n            </div>\n        `).join('');\n    }\n\n    closeUpgradeModal() {\n        const modal = document.querySelector('.upgrade-modal-overlay');\n        if (modal) {\n            modal.remove();\n        }\n    }\n\n    async upgradeTo(targetTier) {\n        try {\n            const response = await fetch(ENDPOINTS.TIERS.UPGRADE, {\n                method: 'POST',\n                headers: {\n                    ...getAuthHeaders(),\n                    'Content-Type': 'application/json'\n                },\n                credentials: 'include',\n                body: JSON.stringify({ target_tier: targetTier })\n            });\n\n            if (response.ok) {\n                this._showToast('Successfully upgraded! Page will reload.', 'success');\n                setTimeout(() => window.location.reload(), 1500);\n            } else {\n                const error = await response.json();\n                this._showToast(error.detail || 'Upgrade failed', 'error');\n            }\n        } catch (error) {\n            this._log('error', 'Upgrade failed:', error);\n            this._showToast('Upgrade failed. Please try again.', 'error');\n        }\n    }\n\n    checkFeatureAccess(feature) {\n        const allowedTiers = FEATURE_ACCESS_MAP[feature] || [];\n        return allowedTiers.includes(this.currentTier);\n    }\n\n    lockFeature(element, feature, requiredTier) {\n        if (!element) return;\n\n        element.classList.add('feature-locked');\n        element.setAttribute('aria-disabled', 'true');\n\n        const overlay = document.createElement('div');\n        overlay.className = 'feature-lock-overlay';\n        overlay.innerHTML = `\n            <i class=\"ph ph-lock\" aria-hidden=\"true\"></i>\n            <h4>${FEATURE_NAMES[feature] || feature}</h4>\n            <p>Available in ${this._capitalize(requiredTier)} tier</p>\n            <button class=\"btn\" data-action=\"show-upgrade\" data-tier=\"${requiredTier}\" data-feature=\"${feature}\" aria-label=\"Upgrade to unlock ${FEATURE_NAMES[feature] || feature}\">\n                Upgrade Now\n            </button>\n        `;\n\n        overlay.querySelector('button').addEventListener('click', () => {\n            this.showUpgradeModal({\n                required_tier: requiredTier,\n                feature: FEATURE_NAMES[feature] || feature\n            });\n        });\n\n        element.style.position = 'relative';\n        element.appendChild(overlay);\n    }\n\n    unlockFeature(element) {\n        if (!element) return;\n\n        element.classList.remove('feature-locked');\n        element.removeAttribute('aria-disabled');\n\n        const overlay = element.querySelector('.feature-lock-overlay');\n        if (overlay) overlay.remove();\n    }\n\n    _capitalize(str) {\n        if (!str) return '';\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    }\n\n    _escapeHtml(text) {\n        if (!text) return '';\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    _showToast(message, type = 'info') {\n        if (typeof window !== 'undefined' && window.showToast) {\n            window.showToast(message, type);\n        } else {\n            alert(message);\n        }\n    }\n\n    _log(level, message, data = null) {\n        if (typeof window !== 'undefined' && window.FrontendLogger) {\n            window.FrontendLogger[level](message, data);\n        } else {\n            const logFn = level === 'error' ? console.error : level === 'warn' ? console.warn : console.log;\n            logFn(`[TierManager] ${message}`, data || '');\n        }\n    }\n}\n\n// Factory function\nexport function initTierManager(options = {}) {\n    const manager = new TierManager(options);\n\n    // Expose globally for legacy scripts\n    if (typeof window !== 'undefined') {\n        window.tierManager = manager;\n    }\n\n    return manager;\n}\n\n// Auto-initialize on DOMContentLoaded if in browser\nlet tierManager;\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            tierManager = initTierManager();\n        });\n    } else {\n        tierManager = initTierManager();\n    }\n}\n\n// Attach to window for legacy scripts\nif (typeof window !== 'undefined') {\n    window.TierManager = TierManager;\n    window.initTierManager = initTierManager;\n    window.FEATURE_ACCESS_MAP = FEATURE_ACCESS_MAP;\n    window.FEATURE_NAMES = FEATURE_NAMES;\n}\n\nexport { tierManager };\n"],"names":["FEATURE_ACCESS_MAP","api_keys","TIERS","PRO","CUSTOM","location_filters","PAYG","isp_filter","affiliate_program","bulk_discounts","priority_support","custom_branding","dedicated_support","FEATURE_NAMES","TierManager","constructor","options","this","currentTier","tierConfig","autoInit","init","loadCurrentTier","renderTierBadge","setupEventListeners","hasAuthToken","response","fetch","ENDPOINTS","CURRENT","headers","getAuthHeaders","credentials","ok","data","json","current_tier","error","_log","headerRight","document","querySelector","existingBadge","remove","badgeContainer","createElement","className","innerHTML","getTierDisplayName","FREEMIUM","balanceDisplay","insertBefore","appendChild","TIER_DISPLAY_NAMES","window","addEventListener","e","showUpgradeModal","detail","key","closeUpgradeModal","details","requiredTier","required_tier","feature","message","modal","setAttribute","_escapeHtml","_capitalize","_getFeatureComparison","body","target","action","dataset","upgradeTo","tier","firstButton","focus","targetTier","features","name","current","map","f","join","UPGRADE","method","JSON","stringify","target_tier","_showToast","setTimeout","location","reload","checkFeatureAccess","includes","lockFeature","element","classList","add","overlay","style","position","unlockFeature","removeAttribute","str","charAt","toUpperCase","slice","text","div","textContent","type","showToast","alert","level","FrontendLogger","console","warn","log","initTierManager","manager","tierManager","readyState"],"mappings":"8GAaO,MAAMA,EAAqB,CAC9BC,SAAY,CAACC,EAAMC,IAAKD,EAAME,QAC9BC,iBAAoB,CAACH,EAAMI,KAAMJ,EAAMC,IAAKD,EAAME,QAClDG,WAAc,CAACL,EAAMI,KAAMJ,EAAMC,IAAKD,EAAME,QAC5CI,kBAAqB,CAACN,EAAMC,IAAKD,EAAME,QACvCK,eAAkB,CAACP,EAAMC,IAAKD,EAAME,QACpCM,iBAAoB,CAACR,EAAMC,IAAKD,EAAME,QACtCO,gBAAmB,CAACT,EAAME,QAC1BQ,kBAAqB,CAACV,EAAME,SAMnBS,EAAgB,CACzBZ,SAAY,WACZI,iBAAoB,mBACpBE,WAAc,wBACdC,kBAAqB,oBACrBC,eAAkB,0BAClBC,iBAAoB,mBACpBC,gBAAmB,kBACnBC,kBAAqB,qBAMlB,MAAME,EACT,WAAAC,CAAYC,EAAU,IAClBC,KAAKC,YAAc,KACnBD,KAAKE,WAAa,KAClBF,KAAKG,UAAgC,IAArBJ,EAAQI,SAEpBH,KAAKG,UACLH,KAAKI,MAEb,CAEA,UAAMA,SACIJ,KAAKK,kBACXL,KAAKM,kBACLN,KAAKO,qBACT,CAEA,qBAAMF,GACF,IACI,IAAKG,IAAgB,OAErB,MAAMC,QAAiBC,MAAMC,EAAU1B,MAAM2B,QAAS,CAClDC,QAASC,IACTC,YAAa,YAGjB,GAAIN,EAASO,GAAI,CACb,MAAMC,QAAaR,EAASS,OAC5BlB,KAAKC,YAAcgB,EAAKE,aACxBnB,KAAKE,WAAae,CACtB,CACJ,OAASG,GACLpB,KAAKqB,KAAK,QAAS,uBAAwBD,EAC/C,CACJ,CAEA,eAAAd,GACI,MAAMgB,EAAcC,SAASC,cAAc,iBAC3C,IAAKF,IAAgBtB,KAAKC,YAAa,OAGvC,MAAMwB,EAAgBH,EAAYE,cAAc,yBAC5CC,KAA6BC,SAEjC,MAAMC,EAAiBJ,SAASK,cAAc,OAC9CD,EAAeE,UAAY,uBAC3BF,EAAeG,UAAY,oDACc9B,KAAKC,0CAA0CD,KAAK+B,2GAEnF/B,KAAK+B,0DAET/B,KAAKC,cAAgBhB,EAAM+C,SAAW,qFAAuF,eAGnI,MAAMC,EAAiBX,EAAYE,cAAc,oBAC7CS,EACAX,EAAYY,aAAaP,EAAgBM,GAEzCX,EAAYa,YAAYR,EAEhC,CAEA,kBAAAI,GACI,OAAOK,EAAmBpC,KAAKC,cAAgB,MACnD,CAEA,mBAAAM,GAEI8B,OAAOC,iBAAiB,kBAAoBC,IACxCvC,KAAKwC,iBAAiBD,EAAEE,UAI5BlB,SAASe,iBAAiB,UAAYC,IACpB,WAAVA,EAAEG,KACF1C,KAAK2C,qBAGjB,CAEA,gBAAAH,CAAiBI,EAAU,IACvB,MAAMC,EAAeD,EAAQE,eAAiB7D,EAAMI,KAC9C0D,EAAUH,EAAQG,SAAW,eAC7BC,EAAUJ,EAAQI,SAAW,GAAGD,cAAoBF,SAG1D7C,KAAK2C,oBAEL,MAAMM,EAAQ1B,SAASK,cAAc,OACrCqB,EAAMpB,UAAY,+BAClBoB,EAAMC,aAAa,OAAQ,UAC3BD,EAAMC,aAAa,aAAc,QACjCD,EAAMC,aAAa,kBAAmB,uBACtCD,EAAMnB,UAAY,wRAKD9B,KAAKmD,YAAYH,qWAQZhD,KAAK+B,6WAOL/B,KAAKoD,YAAYP,wFAGzB7C,KAAKqD,sBAAsBR,0XAOsDA,6BAAwCA,gDAC1G7C,KAAKoD,YAAYP,0FAM9CtB,SAAS+B,KAAKnB,YAAYc,GAG1BA,EAAMX,iBAAiB,QAAUC,IACzBA,EAAEgB,SAAWN,GACbjD,KAAK2C,oBAGT,MAAMa,EAASjB,EAAEgB,OAAOE,QAAQD,OACjB,UAAXA,EACAxD,KAAK2C,oBACa,YAAXa,GACPxD,KAAK0D,UAAUnB,EAAEgB,OAAOE,QAAQE,QAKxC,MAAMC,EAAcX,EAAMzB,cAAc,UACpCoC,KAAyBC,OACjC,CAEA,qBAAAR,CAAsBS,GAClB,MAAMC,EAAW,CACb,CAAC9E,EAAMI,MAAO,CACV,CAAE2E,KAAM,mBAAoBC,SAAS,EAAOV,QAAQ,GACpD,CAAES,KAAM,cAAeC,SAAS,EAAOV,QAAQ,GAC/C,CAAES,KAAM,iBAAkBC,SAAS,EAAOV,QAAQ,IAEtD,CAACtE,EAAMC,KAAM,CACT,CAAE8E,KAAM,aAAcC,QAASjE,KAAKC,cAAgBhB,EAAM+C,SAAUuB,QAAQ,GAC5E,CAAES,KAAM,uBAAwBC,SAAS,EAAOV,QAAQ,GACxD,CAAES,KAAM,WAAYC,QAAS,IAAKV,OAAQ,MAC1C,CAAES,KAAM,oBAAqBC,SAAS,EAAOV,QAAQ,IAEzD,CAACtE,EAAME,QAAS,CACZ,CAAE6E,KAAM,aAAcC,QAASjE,KAAKC,cAAgBhB,EAAMC,IAAKqE,QAAQ,GACvE,CAAES,KAAM,qBAAsBC,SAAS,EAAOV,QAAQ,GACtD,CAAES,KAAM,qBAAsBC,SAAS,EAAOV,QAAQ,GACtD,CAAES,KAAM,oBAAqBC,SAAS,EAAOV,QAAQ,KAK7D,OADoBQ,EAASD,IAAeC,EAAS9E,EAAMI,OACxC6E,IAAIC,GAAK,kFAEOA,EAAEH,qHAECG,EAAEF,QAAU,WAAa,uCAC7CE,EAAEF,SAAW,4KAIbE,EAAEZ,QAAU,0FAI3Ba,KAAK,GACZ,CAEA,iBAAAzB,GACI,MAAMM,EAAQ1B,SAASC,cAAc,0BACjCyB,GACAA,EAAMvB,QAEd,CAEA,eAAMgC,CAAUI,GACZ,IACI,MAAMrD,QAAiBC,MAAMC,EAAU1B,MAAMoF,QAAS,CAClDC,OAAQ,OACRzD,QAAS,IACFC,IACH,eAAgB,oBAEpBC,YAAa,UACbuC,KAAMiB,KAAKC,UAAU,CAAEC,YAAaX,MAGxC,GAAIrD,EAASO,GACThB,KAAK0E,WAAW,2CAA4C,WAC5DC,WAAW,IAAMtC,OAAOuC,SAASC,SAAU,UACxC,CACH,MAAMzD,QAAcX,EAASS,OAC7BlB,KAAK0E,WAAWtD,EAAMqB,QAAU,iBAAkB,QACtD,CACJ,OAASrB,GACLpB,KAAKqB,KAAK,QAAS,kBAAmBD,GACtCpB,KAAK0E,WAAW,oCAAqC,QACzD,CACJ,CAEA,kBAAAI,CAAmB/B,GAEf,OADqBhE,EAAmBgE,IAAY,IAChCgC,SAAS/E,KAAKC,YACtC,CAEA,WAAA+E,CAAYC,EAASlC,EAASF,GAC1B,IAAKoC,EAAS,OAEdA,EAAQC,UAAUC,IAAI,kBACtBF,EAAQ/B,aAAa,gBAAiB,QAEtC,MAAMkC,EAAU7D,SAASK,cAAc,OACvCwD,EAAQvD,UAAY,uBACpBuD,EAAQtD,UAAY,gFAEVlC,EAAcmD,IAAYA,uCACd/C,KAAKoD,YAAYP,sFACyBA,oBAA+BE,oCAA0CnD,EAAcmD,IAAYA,oEAKnKqC,EAAQ5D,cAAc,UAAUc,iBAAiB,QAAS,KACtDtC,KAAKwC,iBAAiB,CAClBM,cAAeD,EACfE,QAASnD,EAAcmD,IAAYA,MAI3CkC,EAAQI,MAAMC,SAAW,WACzBL,EAAQ9C,YAAYiD,EACxB,CAEA,aAAAG,CAAcN,GACV,IAAKA,EAAS,OAEdA,EAAQC,UAAUxD,OAAO,kBACzBuD,EAAQO,gBAAgB,iBAExB,MAAMJ,EAAUH,EAAQzD,cAAc,yBAClC4D,KAAiB1D,QACzB,CAEA,WAAA0B,CAAYqC,GACR,OAAKA,EACEA,EAAIC,OAAO,GAAGC,cAAgBF,EAAIG,MAAM,GAD9B,EAErB,CAEA,WAAAzC,CAAY0C,GACR,IAAKA,EAAM,MAAO,GAClB,MAAMC,EAAMvE,SAASK,cAAc,OAEnC,OADAkE,EAAIC,YAAcF,EACXC,EAAIhE,SACf,CAEA,UAAA4C,CAAW1B,EAASgD,EAAO,QACD,oBAAX3D,QAA0BA,OAAO4D,UACxC5D,OAAO4D,UAAUjD,EAASgD,GAE1BE,MAAMlD,EAEd,CAEA,IAAA3B,CAAK8E,EAAOnD,EAAS/B,EAAO,MACxB,GAAsB,oBAAXoB,QAA0BA,OAAO+D,eACxC/D,OAAO+D,eAAeD,GAAOnD,EAAS/B,OACnC,EACqB,UAAVkF,EAAoBE,QAAQjF,MAAkB,SAAV+E,EAAmBE,QAAQC,KAAOD,QAAQE,KACtF,iBAAiBvD,IAAW/B,GAAQ,GAC9C,CACJ,EAIG,SAASuF,EAAgBzG,EAAU,IACtC,MAAM0G,EAAU,IAAI5G,EAAYE,GAOhC,MAJsB,oBAAXsC,SACPA,OAAOqE,YAAcD,GAGlBA,CACX,CAIsB,oBAAXpE,QAA8C,oBAAbd,WACZ,YAAxBA,SAASoF,WACTpF,SAASe,iBAAiB,mBAAoB,KAC5BkE,MAGJA,KAKA,oBAAXnE,SACPA,OAAOxC,YAAcA,EACrBwC,OAAOmE,gBAAkBA,EACzBnE,OAAOtD,mBAAqBA,EAC5BsD,OAAOzC,cAAgBA"}