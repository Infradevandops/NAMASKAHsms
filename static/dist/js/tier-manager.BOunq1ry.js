import{a as e,E as t,b as a}from"./constants.mniaqQLw.js";import{h as r,g as n}from"./auth-store.D23SS89P.js";const i={api_keys:[e.PRO,e.CUSTOM],location_filters:[e.PAYG,e.PRO,e.CUSTOM],isp_filter:[e.PAYG,e.PRO,e.CUSTOM],affiliate_program:[e.PRO,e.CUSTOM],bulk_discounts:[e.PRO,e.CUSTOM],priority_support:[e.PRO,e.CUSTOM],custom_branding:[e.CUSTOM],dedicated_support:[e.CUSTOM]},s={api_keys:"API Keys",location_filters:"Location Filters",isp_filter:"ISP/Carrier Filtering",affiliate_program:"Affiliate Program",bulk_discounts:"Bulk Purchase Discounts",priority_support:"Priority Support",custom_branding:"Custom Branding",dedicated_support:"Dedicated Support"};class o{constructor(e={}){this.currentTier=null,this.tierConfig=null,this.autoInit=!1!==e.autoInit,this.autoInit&&this.init()}async init(){await this.loadCurrentTier(),this.renderTierBadge(),this.setupEventListeners()}async loadCurrentTier(){try{if(!r())return;const e=await fetch(t.TIERS.CURRENT,{headers:n(),credentials:"include"});if(e.ok){const t=await e.json();this.currentTier=t.current_tier,this.tierConfig=t}}catch(e){this._log("error","Failed to load tier:",e)}}renderTierBadge(){const t=document.querySelector(".header-right");if(!t||!this.currentTier)return;const a=t.querySelector(".tier-badge-container");a&&a.remove();const r=document.createElement("div");r.className="tier-badge-container",r.innerHTML=`\n            <span class="tier-badge tier-badge-${this.currentTier}" aria-label="Current plan: ${this.getTierDisplayName()}">\n                <i class="ph ph-crown" aria-hidden="true"></i>\n                ${this.getTierDisplayName()}\n            </span>\n            ${this.currentTier===e.FREEMIUM?'<a href="/pricing" class="upgrade-link" aria-label="Upgrade your plan">Upgrade</a>':""}\n        `;const n=t.querySelector(".balance-display");n?t.insertBefore(r,n):t.appendChild(r)}getTierDisplayName(){return a[this.currentTier]||"Free"}setupEventListeners(){window.addEventListener("fetch-error-402",e=>{this.showUpgradeModal(e.detail)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closeUpgradeModal()})}showUpgradeModal(t={}){const a=t.required_tier||e.PAYG,r=t.feature||"this feature",n=t.message||`${r} requires ${a} tier`;this.closeUpgradeModal();const i=document.createElement("div");i.className="upgrade-modal-overlay active",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true"),i.setAttribute("aria-labelledby","upgrade-modal-title"),i.innerHTML=`\n            <div class="upgrade-modal">\n                <div class="upgrade-modal-header">\n                    <i class="ph ph-lock feature-locked-icon" aria-hidden="true"></i>\n                    <h2 id="upgrade-modal-title">Upgrade Required</h2>\n                    <p>${this._escapeHtml(n)}</p>\n                </div>\n\n                <div class="tier-comparison-box">\n                    <div class="tier-row">\n                        <span class="tier-label">Your Plan</span>\n                        <span class="tier-value locked">\n                            <i class="ph ph-x" aria-hidden="true"></i>\n                            ${this.getTierDisplayName()}\n                        </span>\n                    </div>\n                    <div class="tier-row">\n                        <span class="tier-label">Required Plan</span>\n                        <span class="tier-value unlocked">\n                            <i class="ph ph-check" aria-hidden="true"></i>\n                            ${this._capitalize(a)}\n                        </span>\n                    </div>\n                    ${this._getFeatureComparison(a)}\n                </div>\n\n                <div class="upgrade-cta-buttons">\n                    <button class="btn-upgrade btn-upgrade-secondary" data-action="close" aria-label="Close upgrade modal">\n                        Maybe Later\n                    </button>\n                    <button class="btn-upgrade btn-upgrade-primary" data-action="upgrade" data-tier="${a}" aria-label="Upgrade to ${a} plan">\n                        Upgrade to ${this._capitalize(a)}\n                    </button>\n                </div>\n            </div>\n        `,document.body.appendChild(i),i.addEventListener("click",e=>{e.target===i&&this.closeUpgradeModal();const t=e.target.dataset.action;"close"===t?this.closeUpgradeModal():"upgrade"===t&&this.upgradeTo(e.target.dataset.tier)});const s=i.querySelector("button");s&&s.focus()}_getFeatureComparison(t){const a={[e.PAYG]:[{name:"Location Filters",current:!1,target:!0},{name:"ISP Filters",current:!1,target:!0},{name:"Custom Balance",current:!1,target:!0}],[e.PRO]:[{name:"API Access",current:this.currentTier!==e.FREEMIUM,target:!0},{name:"All Filters Included",current:!1,target:!0},{name:"API Keys",current:"0",target:"10"},{name:"Affiliate Program",current:!1,target:!0}],[e.CUSTOM]:[{name:"API Access",current:this.currentTier===e.PRO,target:!0},{name:"Unlimited API Keys",current:!1,target:!0},{name:"Enhanced Affiliate",current:!1,target:!0},{name:"Dedicated Support",current:!1,target:!0}]};return(a[t]||a[e.PAYG]).map(e=>`\n            <div class="tier-row">\n                <span class="tier-label">${e.name}</span>\n                <div style="display: flex; gap: 20px;">\n                    <span class="tier-value ${e.current?"unlocked":"locked"}">\n                        ${e.current||"✗"}\n                    </span>\n                    <span aria-hidden="true">→</span>\n                    <span class="tier-value unlocked">\n                        ${e.target||"✓"}\n                    </span>\n                </div>\n            </div>\n        `).join("")}closeUpgradeModal(){const e=document.querySelector(".upgrade-modal-overlay");e&&e.remove()}async upgradeTo(e){try{const a=await fetch(t.TIERS.UPGRADE,{method:"POST",headers:{...n(),"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({target_tier:e})});if(a.ok)this._showToast("Successfully upgraded! Page will reload.","success"),setTimeout(()=>window.location.reload(),1500);else{const e=await a.json();this._showToast(e.detail||"Upgrade failed","error")}}catch(a){this._log("error","Upgrade failed:",a),this._showToast("Upgrade failed. Please try again.","error")}}checkFeatureAccess(e){return(i[e]||[]).includes(this.currentTier)}lockFeature(e,t,a){if(!e)return;e.classList.add("feature-locked"),e.setAttribute("aria-disabled","true");const r=document.createElement("div");r.className="feature-lock-overlay",r.innerHTML=`\n            <i class="ph ph-lock" aria-hidden="true"></i>\n            <h4>${s[t]||t}</h4>\n            <p>Available in ${this._capitalize(a)} tier</p>\n            <button class="btn" data-action="show-upgrade" data-tier="${a}" data-feature="${t}" aria-label="Upgrade to unlock ${s[t]||t}">\n                Upgrade Now\n            </button>\n        `,r.querySelector("button").addEventListener("click",()=>{this.showUpgradeModal({required_tier:a,feature:s[t]||t})}),e.style.position="relative",e.appendChild(r)}unlockFeature(e){if(!e)return;e.classList.remove("feature-locked"),e.removeAttribute("aria-disabled");const t=e.querySelector(".feature-lock-overlay");t&&t.remove()}_capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}_escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}_showToast(e,t="info"){"undefined"!=typeof window&&window.showToast?window.showToast(e,t):alert(e)}_log(e,t,a=null){if("undefined"!=typeof window&&window.FrontendLogger)window.FrontendLogger[e](t,a);else{("error"===e?console.error:"warn"===e?console.warn:console.log)(`[TierManager] ${t}`,a||"")}}}function d(e={}){const t=new o(e);return"undefined"!=typeof window&&(window.tierManager=t),t}"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{d()}):d()),"undefined"!=typeof window&&(window.TierManager=o,window.initTierManager=d,window.FEATURE_ACCESS_MAP=i,window.FEATURE_NAMES=s);
//# sourceMappingURL=tier-manager.BOunq1ry.js.map
