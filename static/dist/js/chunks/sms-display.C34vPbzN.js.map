{"version":3,"file":"sms-display.C34vPbzN.js","sources":["../../../js/modules/sms-display.js"],"sourcesContent":["/**\n * SMS Display Module\n * Handles real-time SMS display and updates\n */\n\nclass SMSDisplay {\n    constructor() {\n        this.pollingInterval = null;\n        this.countdownInterval = null;\n        this.maxPolls = 600; // 20 minutes at 2-second intervals\n        this.pollCount = 0;\n    }\n\n    /**\n     * Start polling for SMS updates\n     */\n    startPolling(verificationId) {\n        this.pollCount = 0;\n        \n        this.pollingInterval = setInterval(async () => {\n            this.pollCount++;\n            \n            try {\n                const response = await axios.get(`/api/verification/${verificationId}`);\n                const verification = response.data;\n\n                // Check if SMS received\n                if (verification.status === 'completed' && verification.sms_code) {\n                    this.displaySMS(verification);\n                    this.stopPolling();\n                    return;\n                }\n\n                // Check if timeout reached\n                if (this.pollCount >= this.maxPolls) {\n                    this.handleTimeout();\n                    this.stopPolling();\n                    return;\n                }\n            } catch (error) {\n                console.error('Polling error:', error);\n                // Continue polling even on error\n            }\n        }, 2000);\n    }\n\n    /**\n     * Stop polling\n     */\n    stopPolling() {\n        if (this.pollingInterval) {\n            clearInterval(this.pollingInterval);\n            this.pollingInterval = null;\n        }\n    }\n\n    /**\n     * Display SMS code and text\n     */\n    displaySMS(verification) {\n        // Hide waiting message\n        const waitingEl = document.getElementById('sms-waiting');\n        if (waitingEl) waitingEl.classList.add('d-none');\n\n        // Show received message\n        const receivedEl = document.getElementById('sms-received');\n        if (receivedEl) receivedEl.classList.remove('d-none');\n\n        // Display SMS code with animation\n        const codeElement = document.getElementById('sms-code');\n        if (codeElement) {\n            codeElement.value = verification.sms_code;\n            codeElement.style.animation = 'none';\n            setTimeout(() => {\n                codeElement.style.animation = 'slideIn 0.5s ease';\n            }, 10);\n        }\n\n        // Show SMS code section\n        const codeSectionEl = document.getElementById('sms-code-section');\n        if (codeSectionEl) codeSectionEl.classList.remove('d-none');\n\n        // Display full SMS text\n        if (verification.sms_text) {\n            const textElement = document.getElementById('sms-text');\n            if (textElement) {\n                textElement.value = verification.sms_text;\n            }\n            const textSectionEl = document.getElementById('sms-text-section');\n            if (textSectionEl) textSectionEl.classList.remove('d-none');\n        }\n\n        // Display receipt timestamp\n        if (verification.sms_received_at) {\n            this.displayTimestamp(verification.sms_received_at);\n        }\n\n        // Update countdown\n        this.updateCountdownToComplete();\n    }\n\n    /**\n     * Display receipt timestamp\n     */\n    displayTimestamp(timestamp) {\n        const receivedTime = new Date(timestamp).toLocaleTimeString();\n        const codeSectionEl = document.getElementById('sms-code-section');\n        \n        if (codeSectionEl) {\n            // Remove existing timestamp if any\n            const existingTimestamp = codeSectionEl.querySelector('.sms-timestamp');\n            if (existingTimestamp) {\n                existingTimestamp.remove();\n            }\n\n            // Add new timestamp\n            const timestampEl = document.createElement('small');\n            timestampEl.className = 'text-muted d-block mt-2 sms-timestamp';\n            timestampEl.textContent = `Received at: ${receivedTime}`;\n            codeSectionEl.appendChild(timestampEl);\n        }\n    }\n\n    /**\n     * Update countdown to show completion\n     */\n    updateCountdownToComplete() {\n        const barEl = document.getElementById('countdown-bar');\n        const textEl = document.getElementById('countdown-text');\n        \n        if (barEl) barEl.style.width = '100%';\n        if (textEl) textEl.textContent = 'SMS Received!';\n        \n        if (this.countdownInterval) {\n            clearInterval(this.countdownInterval);\n            this.countdownInterval = null;\n        }\n    }\n\n    /**\n     * Handle SMS timeout\n     */\n    handleTimeout() {\n        // Hide waiting message\n        const waitingEl = document.getElementById('sms-waiting');\n        if (waitingEl) waitingEl.classList.add('d-none');\n\n        // Show timeout message\n        const timeoutEl = document.getElementById('sms-timeout');\n        if (timeoutEl) timeoutEl.classList.remove('d-none');\n\n        // Update countdown bar\n        const barEl = document.getElementById('countdown-bar');\n        const textEl = document.getElementById('countdown-text');\n        if (barEl) barEl.style.width = '0%';\n        if (textEl) textEl.textContent = '0:00';\n\n        // Show error modal with helpful message\n        this.showTimeoutError();\n    }\n\n    /**\n     * Show timeout error with helpful information\n     */\n    showTimeoutError() {\n        const errorModal = document.getElementById('error-modal');\n        if (!errorModal) return;\n\n        const errorMessageEl = document.getElementById('error-message');\n        if (errorMessageEl) {\n            errorMessageEl.innerHTML = `\n                <strong>SMS Timeout!</strong><br>\n                No SMS received within 20 minutes.<br><br>\n                <small style=\"color: #666;\">This can happen if:</small>\n                <ul style=\"margin-top: 0.5rem; margin-bottom: 0.5rem; padding-left: 1.5rem;\">\n                    <li>The service is experiencing delays</li>\n                    <li>The phone number is invalid</li>\n                    <li>The SMS was blocked by carrier</li>\n                </ul>\n                <br>\n                <a href=\"/billing\" class=\"alert-link\">Add more credits</a> to try again with a different number.\n            `;\n        }\n\n        const modal = new bootstrap.Modal(errorModal);\n        modal.show();\n    }\n\n    /**\n     * Start countdown timer\n     */\n    startCountdown() {\n        let timeRemaining = 1200; // 20 minutes in seconds\n\n        this.countdownInterval = setInterval(() => {\n            timeRemaining--;\n\n            const minutes = Math.floor(timeRemaining / 60);\n            const seconds = timeRemaining % 60;\n            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;\n\n            const textEl = document.getElementById('countdown-text');\n            if (textEl) textEl.textContent = timeString;\n\n            const percentage = (timeRemaining / 1200) * 100;\n            const barEl = document.getElementById('countdown-bar');\n            if (barEl) barEl.style.width = percentage + '%';\n\n            if (timeRemaining <= 0) {\n                clearInterval(this.countdownInterval);\n                this.countdownInterval = null;\n            }\n        }, 1000);\n    }\n\n    /**\n     * Stop countdown timer\n     */\n    stopCountdown() {\n        if (this.countdownInterval) {\n            clearInterval(this.countdownInterval);\n            this.countdownInterval = null;\n        }\n    }\n\n    /**\n     * Reset display\n     */\n    reset() {\n        this.stopPolling();\n        this.stopCountdown();\n\n        // Reset all display elements\n        const elements = [\n            'sms-waiting',\n            'sms-received',\n            'sms-timeout',\n            'sms-code-section',\n            'sms-text-section'\n        ];\n\n        elements.forEach(id => {\n            const el = document.getElementById(id);\n            if (el) {\n                if (id === 'sms-waiting') {\n                    el.classList.remove('d-none');\n                } else {\n                    el.classList.add('d-none');\n                }\n            }\n        });\n\n        // Reset countdown\n        const barEl = document.getElementById('countdown-bar');\n        const textEl = document.getElementById('countdown-text');\n        if (barEl) barEl.style.width = '100%';\n        if (textEl) textEl.textContent = '20:00';\n    }\n}\n\n// Export for use in other modules\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = SMSDisplay;\n}\n"],"names":["require_sms_display_00f","exports","module","SMSDisplay","constructor","this","pollingInterval","countdownInterval","maxPolls","pollCount","startPolling","verificationId","setInterval","async","verification","axios","get","data","status","sms_code","displaySMS","stopPolling","handleTimeout","error","clearInterval","waitingEl","document","getElementById","classList","add","receivedEl","remove","codeElement","value","style","animation","setTimeout","codeSectionEl","sms_text","textElement","textSectionEl","sms_received_at","displayTimestamp","updateCountdownToComplete","timestamp","receivedTime","Date","toLocaleTimeString","existingTimestamp","querySelector","timestampEl","createElement","className","textContent","appendChild","barEl","textEl","width","timeoutEl","showTimeoutError","errorModal","errorMessageEl","innerHTML","bootstrap","Modal","show","startCountdown","timeRemaining","timeString","Math","floor","toString","padStart","percentage","stopCountdown","reset","forEach","id","el"],"mappings":"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"}