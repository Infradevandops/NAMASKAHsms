class t{constructor(){this.charts={},this.filters={dateFrom:null,dateTo:null,services:[],countries:[],status:[]},this.data={statistics:{},dailyStats:[],serviceBreakdown:[],countryBreakdown:[]}}async init(){try{await this.loadStatistics(),await this.loadCharts(),this.setupFilters(),this.setupExport(),this.setupAutoRefresh()}catch(t){this.showError("Failed to initialize analytics dashboard")}}async loadStatistics(){try{const t=localStorage.getItem("access_token"),e=await axios.get("/api/analytics/summary",{headers:{Authorization:`Bearer ${t}`}});this.data.statistics=e.data,this.renderStatistics()}catch(t){this.showError("Failed to load statistics")}}renderStatistics(){const t=this.data.statistics,e=document.getElementById("stat-total-verifications");e&&(e.innerHTML=`\n        <div class="stat-card">\n          <div class="stat-icon bg-primary">\n            <i class="fas fa-check-circle"></i>\n          </div>\n          <div class="stat-content">\n            <h6 class="stat-label">Total Verifications</h6>\n            <h3 class="stat-value">${t.total_verifications||0}</h3>\n            <small class="stat-trend ${t.total_trend>0?"text-success":"text-danger"}">\n              <i class="fas fa-${t.total_trend>0?"arrow-up":"arrow-down"}"></i>\n              ${Math.abs(t.total_trend||0)}% this month\n            </small>\n          </div>\n        </div>\n      `);const s=document.getElementById("stat-success-rate");s&&(s.innerHTML=`\n        <div class="stat-card">\n          <div class="stat-icon bg-success">\n            <i class="fas fa-percentage"></i>\n          </div>\n          <div class="stat-content">\n            <h6 class="stat-label">Success Rate</h6>\n            <h3 class="stat-value">${(t.success_rate||0).toFixed(1)}%</h3>\n            <small class="stat-trend ${t.success_trend>0?"text-success":"text-danger"}">\n              <i class="fas fa-${t.success_trend>0?"arrow-up":"arrow-down"}"></i>\n              ${Math.abs(t.success_trend||0).toFixed(1)}% change\n            </small>\n          </div>\n        </div>\n      `);const a=document.getElementById("stat-active-rentals");a&&(a.innerHTML=`\n        <div class="stat-card">\n          <div class="stat-icon bg-info">\n            <i class="fas fa-phone"></i>\n          </div>\n          <div class="stat-content">\n            <h6 class="stat-label">Active Rentals</h6>\n            <h3 class="stat-value">${t.active_rentals||0}</h3>\n            <small class="stat-trend text-muted">\n              <i class="fas fa-clock"></i>\n              Currently active\n            </small>\n          </div>\n        </div>\n      `);const i=document.getElementById("stat-credit-balance");i&&(i.innerHTML=`\n        <div class="stat-card">\n          <div class="stat-icon bg-warning">\n            <i class="fas fa-coins"></i>\n          </div>\n          <div class="stat-content">\n            <h6 class="stat-label">Credit Balance</h6>\n            <h3 class="stat-value">$${(t.credit_balance||0).toFixed(2)}</h3>\n            <small class="stat-trend text-muted">\n              <i class="fas fa-wallet"></i>\n              Available balance\n            </small>\n          </div>\n        </div>\n      `)}async loadCharts(){try{const t=this.buildFilterParams(),e=await axios.get("/api/analytics/daily-stats",{params:t});this.data.dailyStats=e.data;const s=await axios.get("/api/analytics/service-breakdown",{params:t});this.data.serviceBreakdown=s.data;const a=await axios.get("/api/analytics/country-breakdown",{params:t});this.data.countryBreakdown=a.data,this.renderCharts()}catch(t){this.showError("Failed to load chart data")}}renderCharts(){Object.values(this.charts).forEach(t=>{t&&t.destroy()}),this.charts={},this.createVerificationsChart(),this.createSuccessRateChart(),this.createServiceChart(),this.createCountryChart()}createVerificationsChart(){const t=document.getElementById("chart-verifications");if(!t)return;const e=this.data.dailyStats.map(t=>t.date),s=this.data.dailyStats.map(t=>t.count);this.charts.verifications=new Chart(t,{type:"line",data:{labels:e,datasets:[{label:"Verifications",data:s,borderColor:"#007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",borderWidth:2,fill:!0,tension:.4,pointRadius:4,pointBackgroundColor:"#007bff",pointBorderColor:"#fff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Verifications Over Time"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})}createSuccessRateChart(){const t=document.getElementById("chart-success-rate");if(!t)return;const e=this.data.dailyStats.map(t=>t.date),s=this.data.dailyStats.map(t=>t.success_rate);this.charts.successRate=new Chart(t,{type:"line",data:{labels:e,datasets:[{label:"Success Rate (%)",data:s,borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",borderWidth:2,fill:!0,tension:.4,pointRadius:4,pointBackgroundColor:"#28a745",pointBorderColor:"#fff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Success Rate Trend"}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(t){return t+"%"}}}}}})}createServiceChart(){const t=document.getElementById("chart-service-breakdown");if(!t)return;const e=this.data.serviceBreakdown.map(t=>t.service),s=this.data.serviceBreakdown.map(t=>t.count);this.charts.service=new Chart(t,{type:"doughnut",data:{labels:e,datasets:[{data:s,backgroundColor:["#007bff","#28a745","#ffc107","#dc3545","#17a2b8","#6f42c1","#e83e8c","#fd7e14"].slice(0,e.length),borderColor:"#fff",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"bottom"},title:{display:!0,text:"Service Breakdown"}}}})}createCountryChart(){const t=document.getElementById("chart-country-breakdown");if(!t)return;const e=this.data.countryBreakdown.map(t=>t.country),s=this.data.countryBreakdown.map(t=>t.count);this.charts.country=new Chart(t,{type:"bar",data:{labels:e,datasets:[{label:"Verifications",data:s,backgroundColor:"#007bff",borderColor:"#0056b3",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{display:!1},title:{display:!0,text:"Country Breakdown"}},scales:{x:{beginAtZero:!0,ticks:{stepSize:1}}}}})}setupFilters(){const t=document.getElementById("filter-date-from"),e=document.getElementById("filter-date-to");t&&t.addEventListener("change",t=>{this.filters.dateFrom=t.target.value,this.applyFilters()}),e&&e.addEventListener("change",t=>{this.filters.dateTo=t.target.value,this.applyFilters()});const s=document.getElementById("filter-service");s&&s.addEventListener("change",t=>{this.filters.services=Array.from(t.target.selectedOptions,t=>t.value),this.applyFilters()});const a=document.getElementById("filter-country");a&&a.addEventListener("change",t=>{this.filters.countries=Array.from(t.target.selectedOptions,t=>t.value),this.applyFilters()});const i=document.getElementById("filter-status");i&&i.addEventListener("change",t=>{this.filters.status=Array.from(t.target.selectedOptions,t=>t.value),this.applyFilters()});const r=document.getElementById("btn-clear-filters");r&&r.addEventListener("click",()=>this.clearFilters()),this.loadFiltersFromStorage()}async applyFilters(){try{this.saveFiltersToStorage(),await this.loadCharts(),this.updateFilterIndicators()}catch(t){this.showError("Failed to apply filters")}}async clearFilters(){this.filters={dateFrom:null,dateTo:null,services:[],countries:[],status:[]},document.getElementById("filter-date-from").value="",document.getElementById("filter-date-to").value="",document.getElementById("filter-service").selectedIndex=-1,document.getElementById("filter-country").selectedIndex=-1,document.getElementById("filter-status").selectedIndex=-1,localStorage.removeItem("analytics-filters"),await this.loadCharts(),this.updateFilterIndicators()}buildFilterParams(){const t={};return this.filters.dateFrom&&(t.date_from=this.filters.dateFrom),this.filters.dateTo&&(t.date_to=this.filters.dateTo),this.filters.services.length>0&&(t.services=this.filters.services.join(",")),this.filters.countries.length>0&&(t.countries=this.filters.countries.join(",")),this.filters.status.length>0&&(t.status=this.filters.status.join(",")),t}updateFilterIndicators(){const t=document.getElementById("filter-indicator");if(!t)return;const e=[this.filters.dateFrom?1:0,this.filters.dateTo?1:0,this.filters.services.length,this.filters.countries.length,this.filters.status.length].reduce((t,e)=>t+e,0);e>0?(t.innerHTML=`<span class="badge bg-primary">${e} active</span>`,t.style.display="inline-block"):t.style.display="none"}saveFiltersToStorage(){localStorage.setItem("analytics-filters",JSON.stringify(this.filters))}loadFiltersFromStorage(){const t=localStorage.getItem("analytics-filters");if(t)try{this.filters=JSON.parse(t),this.filters.dateFrom&&(document.getElementById("filter-date-from").value=this.filters.dateFrom),this.filters.dateTo&&(document.getElementById("filter-date-to").value=this.filters.dateTo)}catch(e){}}setupExport(){const t=document.getElementById("btn-export-csv"),e=document.getElementById("btn-export-pdf"),s=document.getElementById("btn-export-email");t&&t.addEventListener("click",()=>this.exportCSV()),e&&e.addEventListener("click",()=>this.exportPDF()),s&&s.addEventListener("click",()=>this.exportEmail())}async exportCSV(){try{const t=this.buildFilterParams(),e=await axios.post("/api/analytics/export",{format:"csv",...t},{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=s,a.setAttribute("download",`analytics-${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a),this.showSuccess("Analytics exported to CSV")}catch(t){this.showError("Failed to export CSV")}}async exportPDF(){try{const t=this.buildFilterParams(),e=await axios.post("/api/analytics/export",{format:"pdf",...t},{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=s,a.setAttribute("download",`analytics-${(new Date).toISOString().split("T")[0]}.pdf`),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a),this.showSuccess("Analytics exported to PDF")}catch(t){this.showError("Failed to export PDF")}}async exportEmail(){try{const t=prompt("Enter email address to send report:");if(!t)return;const e=this.buildFilterParams();await axios.post("/api/analytics/export",{format:"email",email:t,...e}),this.showSuccess(`Report sent to ${t}`)}catch(t){this.showError("Failed to send email report")}}setupAutoRefresh(){setInterval(()=>{this.loadStatistics()},3e4),setInterval(()=>{this.loadCharts()},3e5)}showSuccess(t){window.showToast?window.showToast(t,"success"):alert(t)}showError(t){window.showToast?window.showToast(t,"error"):alert(t)}}document.addEventListener("DOMContentLoaded",()=>{const e=new t;e.init(),window.analyticsManager=e});
//# sourceMappingURL=analytics.CIBchW2O.js.map
