class e{constructor(){this.currentVerification=null,this.pollingInterval=null,this.countdownInterval=null,this.services=[],this.countries=[],this.init()}async init(){this.setupEventListeners(),await this.loadServices(),await this.loadCountries(),await this.loadUserBalance(),await this.loadVerificationHistory()}setupEventListeners(){var e,t,n,o,s;document.getElementById("verification-form").addEventListener("submit",e=>{e.preventDefault(),this.handleFormSubmit()}),document.getElementById("service-select").addEventListener("change",()=>this.updateCostEstimate()),document.getElementById("country-select").addEventListener("change",()=>this.updateCostEstimate()),null==(e=document.getElementById("copy-phone-btn"))||e.addEventListener("click",()=>this.copyToClipboard("phone-number")),null==(t=document.getElementById("copy-code-btn"))||t.addEventListener("click",()=>this.copyToClipboard("sms-code")),null==(n=document.getElementById("release-btn"))||n.addEventListener("click",()=>this.releaseNumber()),null==(o=document.getElementById("new-verification-btn"))||o.addEventListener("click",()=>this.resetForm()),null==(s=document.getElementById("confirm-purchase-btn"))||s.addEventListener("click",()=>this.confirmPurchase())}async loadServices(){try{const e=await axios.get("/api/pricing/services");this.services=Object.keys(e.data.services),this.populateServiceSelect()}catch(e){this.showError("Failed to load services")}}async loadCountries(){try{const e=await axios.get("/api/pricing/countries");this.countries=Object.keys(e.data.countries),this.populateCountrySelect()}catch(e){this.showError("Failed to load countries")}}async loadUserBalance(){try{const e=(await axios.get("/api/user/balance")).data.credits;document.getElementById("user-balance").textContent=`$${e.toFixed(2)}`,document.getElementById("balance-display").textContent=`$${e.toFixed(2)}`}catch(e){}}async loadVerificationHistory(){try{const e=await axios.get("/api/verification/history?limit=10");this.populateVerificationHistory(e.data.verifications)}catch(e){}}populateServiceSelect(){const e=document.getElementById("service-select");this.services.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t.charAt(0).toUpperCase()+t.slice(1),e.appendChild(n)})}populateCountrySelect(){const e=document.getElementById("country-select");this.countries.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)})}populateVerificationHistory(e){const t=document.getElementById("verification-history");t.innerHTML="",0!==e.length?e.forEach(e=>{const n=document.createElement("tr"),o=this.getStatusBadge(e.status),s=new Date(e.created_at).toLocaleDateString();n.innerHTML=`\n                <td>${e.service}</td>\n                <td>${e.country}</td>\n                <td><code>${e.phone_number}</code></td>\n                <td>${o}</td>\n                <td>$${e.cost.toFixed(2)}</td>\n                <td>${s}</td>\n                <td>\n                    <button class="btn btn-sm btn-outline-primary" onclick="verificationManager.viewDetails('${e.id}')">\n                        <i class="fas fa-eye"></i>\n                    </button>\n                </td>\n            `,t.appendChild(n)}):t.innerHTML='<tr><td colspan="7" class="text-center text-muted">No verifications yet</td></tr>'}getStatusBadge(e){return{pending:'<span class="badge bg-warning">Pending</span>',completed:'<span class="badge bg-success">Completed</span>',timeout:'<span class="badge bg-danger">Timeout</span>',released:'<span class="badge bg-secondary">Released</span>'}[e]||`<span class="badge bg-secondary">${e}</span>`}async updateCostEstimate(){const e=document.getElementById("service-select").value,t=document.getElementById("country-select").value;if(e&&t)try{const n=(await axios.get("/api/pricing/estimate",{params:{service:e,country:t,tier:"STANDARD",quantity:1}})).data.total_cost;document.getElementById("estimated-cost").textContent=`$${n.toFixed(2)}`;const o=document.getElementById("user-balance").textContent,s=parseFloat(o.replace("$","")),i=document.getElementById("insufficient-balance-alert");s<n?(i.classList.remove("d-none"),document.getElementById("purchase-btn").disabled=!0):(i.classList.add("d-none"),document.getElementById("purchase-btn").disabled=!1)}catch(n){}else document.getElementById("estimated-cost").textContent="$0.00"}async handleFormSubmit(){const e=document.getElementById("service-select").value,t=document.getElementById("country-select").value;if(document.querySelector('input[name="capability"]:checked').value,!e||!t)return void this.showError("Please select a service and country");document.getElementById("confirm-service").textContent=e,document.getElementById("confirm-country").textContent=t;const n=document.getElementById("estimated-cost").textContent;document.getElementById("confirm-cost").textContent=n;const o=document.getElementById("user-balance").textContent,s=parseFloat(o.replace("$","")),i=parseFloat(n.replace("$",""));document.getElementById("confirm-balance").textContent=`$${(s-i).toFixed(2)}`;new bootstrap.Modal(document.getElementById("confirmation-modal")).show()}async confirmPurchase(){var e,t;const n=document.getElementById("service-select").value,o=document.getElementById("country-select").value,s=document.querySelector('input[name="capability"]:checked').value;bootstrap.Modal.getInstance(document.getElementById("confirmation-modal")).hide();const i=new bootstrap.Modal(document.getElementById("loading-modal"));i.show();try{const e=await axios.post("/api/verification/request",{service:n,country:o,capability:s});this.currentVerification=e.data,i.hide(),this.displayVerificationResult(),this.startPolling(),this.startCountdown(),document.getElementById("verification-form").parentElement.classList.add("d-none"),document.getElementById("verification-result").classList.remove("d-none"),document.getElementById("help-card").classList.add("d-none"),this.showSuccess("Verification purchased successfully!")}catch(a){i.hide();const n=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.detail)||"Failed to purchase verification";this.showError(n)}}displayVerificationResult(){const e=this.currentVerification;document.getElementById("phone-number").value=e.phone_number;const t=document.getElementById("qr-code");t.innerHTML="",new QRCode(t,{text:e.phone_number,width:150,height:150})}startPolling(){let e=0;this.pollingInterval=setInterval(async()=>{e++;try{const t=(await axios.get(`/api/verification/${this.currentVerification.verification_id}`)).data;if("completed"===t.status&&t.sms_code)return this.handleSMSReceived(t),void clearInterval(this.pollingInterval);if(e>=600)return clearInterval(this.pollingInterval),void this.handleTimeout()}catch(t){}},2e3)}handleSMSReceived(e){document.getElementById("sms-waiting").classList.add("d-none"),document.getElementById("sms-received").classList.remove("d-none");const t=document.getElementById("sms-code");if(t.value=e.sms_code,t.style.animation="none",setTimeout(()=>{t.style.animation="slideIn 0.5s ease"},10),document.getElementById("sms-code-section").classList.remove("d-none"),e.sms_text&&(document.getElementById("sms-text").value=e.sms_text,document.getElementById("sms-text-section").classList.remove("d-none")),e.sms_received_at){const t=new Date(e.sms_received_at).toLocaleTimeString(),n=document.createElement("small");n.className="text-muted d-block mt-2",n.textContent=`Received at: ${t}`,document.getElementById("sms-code-section").appendChild(n)}clearInterval(this.countdownInterval),document.getElementById("countdown-bar").style.width="100%",document.getElementById("countdown-text").textContent="SMS Received!",this.showSuccess("SMS received! Code is ready to use.")}startCountdown(){let e=1200;this.countdownInterval=setInterval(()=>{e--;const t=`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;document.getElementById("countdown-text").textContent=t;const n=e/1200*100;document.getElementById("countdown-bar").style.width=n+"%",e<=0&&(clearInterval(this.countdownInterval),this.handleTimeout())},1e3)}handleTimeout(){document.getElementById("sms-waiting").classList.add("d-none"),document.getElementById("sms-timeout").classList.remove("d-none"),clearInterval(this.pollingInterval),clearInterval(this.countdownInterval),document.getElementById("countdown-bar").style.width="0%",document.getElementById("countdown-text").textContent="0:00";const e=document.getElementById("error-modal");document.getElementById("error-message").innerHTML='\n            <strong>SMS Timeout!</strong><br>\n            No SMS received within 20 minutes.<br><br>\n            <small>This can happen if:</small>\n            <ul style="margin-top: 0.5rem; margin-bottom: 0;">\n                <li>The service is experiencing delays</li>\n                <li>The phone number is invalid</li>\n                <li>The SMS was blocked</li>\n            </ul>\n            <br>\n            <a href="/billing" class="alert-link">Add more credits</a> to try again with a different number.\n        ';new bootstrap.Modal(e).show()}async releaseNumber(){var e,t;if(this.currentVerification&&confirm("Are you sure you want to release this number?"))try{await axios.post(`/api/verification/${this.currentVerification.verification_id}/release`),this.showSuccess("Number released successfully"),this.resetForm()}catch(n){const o=(null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.detail)||"Failed to release number";this.showError(o)}}resetForm(){document.getElementById("verification-form").reset(),this.currentVerification=null,clearInterval(this.pollingInterval),clearInterval(this.countdownInterval),document.getElementById("verification-form").parentElement.classList.remove("d-none"),document.getElementById("verification-result").classList.add("d-none"),document.getElementById("help-card").classList.remove("d-none"),document.getElementById("sms-waiting").classList.remove("d-none"),document.getElementById("sms-received").classList.add("d-none"),document.getElementById("sms-timeout").classList.add("d-none"),document.getElementById("sms-code-section").classList.add("d-none"),document.getElementById("sms-text-section").classList.add("d-none"),this.loadVerificationHistory()}async viewDetails(e){try{const t=(await axios.get(`/api/verification/${e}`)).data;alert(`\nService: ${t.service}\nCountry: ${t.country}\nPhone: ${t.phone_number}\nStatus: ${t.status}\nCost: $${t.cost}\n${t.sms_code?`SMS Code: ${t.sms_code}`:""}\n            `)}catch(t){this.showError("Failed to load verification details")}}copyToClipboard(e){const t=document.getElementById(e),n=t.value;navigator.clipboard.writeText(n).then(()=>{this.showSuccess("Copied to clipboard!");const e=event.target.closest("button");if(e){const t=e.innerHTML;e.innerHTML='<i class="fas fa-check"></i> Copied!',e.disabled=!0,setTimeout(()=>{e.innerHTML=t,e.disabled=!1},2e3)}}).catch(()=>{try{t.select(),document.execCommand("copy"),this.showSuccess("Copied to clipboard!")}catch(e){this.showError("Failed to copy to clipboard")}})}showError(e){document.getElementById("error-message").textContent=e;new bootstrap.Modal(document.getElementById("error-modal")).show()}showSuccess(e){document.getElementById("toast-message").textContent=e;new bootstrap.Toast(document.getElementById("success-toast")).show()}}document.addEventListener("DOMContentLoaded",()=>{new e});
//# sourceMappingURL=verification.DoOECp4r.js.map
