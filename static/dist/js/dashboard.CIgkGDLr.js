const e=new class{constructor(){this.state={user:null,balance:0,currentView:"home",verification:{step:1,areaCode:null,service:null,carrier:null,cost:0,verificationId:null,pollingInterval:null,areaCodes:[],services:[],carriers:[]}},this.listeners=[]}setState(e){this.state={...this.state,...e},this.notify()}subscribe(e){this.listeners.push(e)}unsubscribe(e){this.listeners=this.listeners.filter(t=>t!==e)}notify(){this.listeners.forEach(e=>e(this.state))}getState(){return this.state}},t=Object.freeze(Object.defineProperty({__proto__:null,stateManager:e},Symbol.toStringTag,{value:"Module"})),n={async getCountries(){try{const e=await fetch("/api/countries/");if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){throw e}},async getAreaCodes(){try{const e=await fetch("/api/countries/usa/area-codes");if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){throw e}},async getServices(e){try{const t=new URLSearchParams({areaCode:e||"any"}),n=await fetch(`/api/countries/usa/services?${t}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}catch(t){throw t}},async getCarriers(){try{const e=await fetch("/api/countries/usa/carriers");if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){throw e}},async getPricing(e,t,n){try{const a=new URLSearchParams({service:e,area_code:t||"any",carrier:n||"any"}),i=await fetch(`/api/verification/pricing?${a}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);return await i.json()}catch(a){throw a}},async purchaseVerification(e,t,n){try{const a=await fetch("/api/verification/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service:e,area_code:t,carrier:n})});if(!a.ok)throw new Error(`HTTP ${a.status}`);return await a.json()}catch(a){throw a}},async initializePayment(e){try{const t=await fetch("/api/billing/initialize-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount_usd:e})});if(503===t.status)throw new Error("Payment gateway unavailable. Please contact support.");if(!t.ok){const e=await t.json();throw new Error(e.detail||`HTTP ${t.status}`)}return await t.json()}catch(t){throw t}},async saveSettings(e,t){try{const n=await fetch(`/api/user/settings/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}catch(n){throw n}},async logoutAll(){try{const e=await fetch("/api/user/logout-all",{method:"POST"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}catch(e){throw e}},async deleteAccount(e){try{const t=await fetch("/api/user/delete-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(t){throw t}}},a=Object.freeze(Object.defineProperty({__proto__:null,api:n},Symbol.toStringTag,{value:"Module"}));class i extends Error{constructor(e,t){super(t),this.status=e,this.name="APIError"}}const r={400:"Invalid request. Please check your input.",401:"Session expired. Please login again.",402:"Insufficient balance. Please add credits.",404:"Resource not found.",429:"Too many requests. Please wait a moment.",500:"Server error. Please try again later.",503:"Service unavailable. Please try again later."};function o(e){return e instanceof i?r[e.status]||"An error occurred":e.message?e.message:"Unknown error occurred"}function s(e,t){}const c=Object.freeze(Object.defineProperty({__proto__:null,APIError:i,errorMessages:r,handleError:o,logError:s},Symbol.toStringTag,{value:"Module"})),l={areaCode:e=>e?/^\d{3}$/.test(e)?{valid:!0}:{valid:!1,error:"Invalid area code format"}:{valid:!1,error:"Area code required"},service:e=>e?"string"!=typeof e?{valid:!1,error:"Invalid service"}:{valid:!0}:{valid:!1,error:"Service required"},carrier:e=>e&&"string"!=typeof e?{valid:!1,error:"Invalid carrier"}:{valid:!0}};function d(e){const t={},n=l.areaCode(e.areaCode);n.valid||(t.areaCode=n.error);const a=l.service(e.service);a.valid||(t.service=a.error);const i=l.carrier(e.carrier);return i.valid||(t.carrier=i.error),{valid:0===Object.keys(t).length,errors:t}}const u=Object.freeze(Object.defineProperty({__proto__:null,validateVerification:d,validators:l},Symbol.toStringTag,{value:"Module"}));function p(e,t="info"){const n=document.createElement("div");n.className=`toast toast-${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}function m(){document.querySelectorAll(".modal").forEach(e=>{e.classList.remove("show")}),document.body.style.overflow=""}function y(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}function g(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function v(e){const t=`$${e.toFixed(2)}`;[document.getElementById("header-balance"),document.getElementById("stat-balance"),document.getElementById("wallet-balance")].forEach(e=>{e&&(e.textContent=t)})}function h(e){const t=document.getElementById(e);t&&t.classList.add("loading")}function f(e){const t=document.getElementById(e);t&&t.classList.remove("loading")}const w=Object.freeze(Object.defineProperty({__proto__:null,escapeHtml:y,formatDate:g,hideLoading:f,hideModals:m,showLoading:h,showToast:p,updateBalanceDisplay:v},Symbol.toStringTag,{value:"Module"}));const b=new class{constructor(e=36e5){this.data=new Map,this.ttl=e}set(e,t,n=this.ttl){this.data.set(e,{value:t,expires:Date.now()+n})}get(e){const t=this.data.get(e);return t?Date.now()>t.expires?(this.data.delete(e),null):t.value:null}clear(){this.data.clear()}has(e){return null!==this.get(e)}},E="areaCodeChanged",x="serviceChanged",k="carrierChanged",I="verificationStarted",L="verificationCompleted",T="errorOccurred";const S=new class{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(e=>e(t))}off(e,t){if(this.listeners.has(e)){const n=this.listeners.get(e),a=n.indexOf(t);a>-1&&n.splice(a,1)}}};function B(){!function(){var e,t,a,i,r,o,s,c,l,d,u,y,g,v,h;const f=document.getElementById("sidebar-toggle");f&&f.addEventListener("click",C);const w=document.getElementById("user-avatar-btn");w&&w.addEventListener("click",$);document.addEventListener("click",function(e){const t=document.getElementById("user-dropdown"),n=document.getElementById("user-avatar-btn");!t||t.contains(e.target)||n.contains(e.target)||t.classList.remove("show")}),null==(e=document.getElementById("logout-btn"))||e.addEventListener("click",_),null==(t=document.getElementById("dropdown-logout"))||t.addEventListener("click",_),null==(a=document.getElementById("new-verification-btn"))||a.addEventListener("click",A),null==(i=document.getElementById("quick-verification-btn"))||i.addEventListener("click",A),null==(r=document.getElementById("verification-close-btn"))||r.addEventListener("click",j),null==(o=document.getElementById("step1-cancel"))||o.addEventListener("click",j),null==(s=document.getElementById("step1-next"))||s.addEventListener("click",()=>U(2)),null==(c=document.getElementById("step2-back"))||c.addEventListener("click",()=>U(1)),null==(l=document.getElementById("step2-next"))||l.addEventListener("click",()=>U(3)),null==(d=document.getElementById("step3-back"))||d.addEventListener("click",()=>U(2)),null==(u=document.getElementById("step3-purchase"))||u.addEventListener("click",N),null==(y=document.getElementById("step4-close"))||y.addEventListener("click",j),null==(g=document.getElementById("area-code-select"))||g.addEventListener("change",O),null==(v=document.getElementById("service-select"))||v.addEventListener("change",F),null==(h=document.getElementById("carrier-select"))||h.addEventListener("change",z),document.addEventListener("keydown",function(e){"Escape"===e.key&&m()}),window.addEventListener("focus",M),function(){const e=document.getElementById("credits-modal"),t=[document.getElementById("quick-credits-btn"),document.getElementById("add-credits-btn")],a=[document.getElementById("credits-close-btn"),document.getElementById("credits-cancel-btn")],i=document.getElementById("credits-proceed-btn"),r=document.getElementById("credit-amount"),o=document.querySelectorAll(".package");let s=0;function c(){e&&e.classList.add("show")}function l(){e&&e.classList.remove("show"),o.forEach(e=>e.classList.remove("selected")),r&&(r.value=""),s=0}t.forEach(e=>null==e?void 0:e.addEventListener("click",c)),a.forEach(e=>null==e?void 0:e.addEventListener("click",l)),o.forEach(e=>{e.addEventListener("click",()=>{o.forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),s=parseFloat(e.dataset.amount),r&&(r.value="")})}),null==r||r.addEventListener("input",()=>{o.forEach(e=>e.classList.remove("selected")),s=parseFloat(r.value)}),null==i||i.addEventListener("click",async()=>{if(!s||s<1)p("Please select an amount (minimum $1)","warning");else try{i.innerHTML;i.innerHTML='<div class="spinner-small"></div> Processing...',i.disabled=!0;const e=await n.initializePayment(s);if(!e.authorization_url)throw new Error("No payment URL returned");window.location.href=e.authorization_url}catch(e){p(e.message,"error"),i.disabled=!1,i.innerHTML="Proceed to Payment"}})}()}(),window.addEventListener("online",()=>{p("Back online! Syncing data...","success"),P(),M()}),window.addEventListener("offline",()=>{p("You are offline. Some features may not work.","warning")}),navigator.onLine||p("You are offline. Some features may not work.","warning"),m(),function(){var e;const t=new URLSearchParams(window.location.search);H(t.get("view")||"home"),document.querySelectorAll(".nav-item[data-view]").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-view");H(t),function(e){const t="home"===e?"/dashboard":`/dashboard?view=${e}`;window.history.pushState({view:e},"",t)}(t)})}),"true"===localStorage.getItem("sidebarCollapsed")&&(null==(e=document.getElementById("sidebar"))||e.classList.add("collapsed"))}(),async function(){const e=document.getElementById("recent-activity-list");if(!e)return;try{const t=await fetch("/api/dashboard/activity/recent",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Cache-Control":"no-cache"}});if(401===t.status)return;if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json(),a=n.activities||n||[];0===a.length?e.innerHTML='<div class="empty-state" style="padding: 40px 20px; text-align: center; color: #6b7280;">No recent activity</div>':e.innerHTML=a.slice(0,5).map(e=>`\n        <div class="activity-item" style="padding: 12px; border-bottom: 1px solid #e5e7eb;">\n          <div style="font-weight: 500;">${y(e.description||"Activity")}</div>\n          <div style="font-size: 13px; color: #6b7280;">${g(e.created_at)}</div>\n        </div>\n      `).join("")}catch(t){t.name}}(),P().catch(e=>{p("Could not load user profile. Using defaults.","warning")}),M().catch(e=>{p("Could not load balance. Please refresh.","warning")})}function C(){const e=document.getElementById("sidebar");e&&(e.classList.toggle("collapsed"),localStorage.setItem("sidebarCollapsed",e.classList.contains("collapsed")))}function $(){const e=document.getElementById("user-dropdown");e&&e.classList.toggle("show")}async function P(){try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a=await fetch("/api/user/profile",{signal:t.signal});if(clearTimeout(n),!a.ok){if(401===a.status)return p("Session expired. Redirecting to login...","warning"),void setTimeout(()=>window.location.href="/auth/login",1500);throw new Error(`HTTP ${a.status}: ${a.statusText}`)}const i=await a.json();e.setState({user:i});const r=document.getElementById("dropdown-email"),o=document.getElementById("user-initials");if(r&&(r.textContent=i.email||"User"),o){const e=(i.email||"U").charAt(0).toUpperCase();o.textContent=e}}catch(t){const e=document.getElementById("dropdown-email"),n=document.getElementById("user-initials");e&&(e.textContent="User"),n&&(n.textContent="U"),t.name}}async function _(e){if(e.preventDefault(),confirm("Are you sure you want to logout?")){try{await fetch("/api/auth/logout",{method:"POST"})}catch(t){}localStorage.clear(),window.location.href="/auth/login"}}async function M(){try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a=await fetch("/api/user/balance",{headers:{"Cache-Control":"no-cache"},signal:t.signal});if(clearTimeout(n),!a.ok){if(401===a.status)return p("Session expired. Redirecting to login...","warning"),void setTimeout(()=>window.location.href="/auth/login",1500);throw new Error(`HTTP ${a.status}: ${a.statusText}`)}const i=await a.json(),r=parseFloat(i.credits)||0;e.setState({balance:r}),v(r)}catch(t){v(0),t.name}}function H(t){e.setState({currentView:t}),document.querySelectorAll(".view").forEach(e=>e.classList.remove("active"));const a=document.getElementById(`${t}-view`);switch(a&&a.classList.add("active"),document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active"),e.getAttribute("data-view")===t&&e.classList.add("active")}),t){case"rentals":!async function(){const e=document.getElementById("rentals-list");if(!e)return;try{const t=await fetch("/api/rentals");if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json(),a=n.rentals||n||[];0===a.length?e.innerHTML='<div class="empty-state" style="padding: 60px 20px; text-align: center;"><i class="ph ph-phone" style="font-size: 64px; opacity: 0.3; display: block; margin-bottom: 16px;"></i><h3 style="margin: 0 0 8px 0;">No Active Rentals</h3><p style="color: var(--gray-500); margin: 0;">You don\'t have any active phone rentals yet.</p></div>':e.innerHTML=a.map(e=>`<div class="activity-item" style="padding: 16px; border-bottom: 1px solid #e5e7eb;"><div><div style="font-weight: 600;">${y(e.phone_number||"N/A")}</div><div style="font-size: 14px; color: #6b7280;">${y(e.service_name||"Unknown")}</div></div><div style="text-align: right;"><div style="font-weight: 600;">$${(e.cost||0).toFixed(2)}</div></div></div>`).join("")}catch(t){e.innerHTML='<div class="empty-state" style="padding: 40px 20px; text-align: center;"><i class="ph ph-warning-circle" style="font-size: 48px; opacity: 0.5; color: #ef4444;"></i><p>Failed to load rentals</p></div>'}}();break;case"wallet":!async function(){const e=document.getElementById("transactions-list");if(!e)return;try{const t=await fetch("/api/wallet/transactions");if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json(),a=n.transactions||n||[];0===a.length?e.innerHTML='<div class="empty-state" style="padding: 60px 20px; text-align: center;"><i class="ph ph-receipt" style="font-size: 64px; opacity: 0.3; display: block; margin-bottom: 16px;"></i><h3 style="margin: 0 0 8px 0;">No Transactions</h3><p style="color: var(--gray-500); margin: 0;">Your transaction history will appear here.</p></div>':e.innerHTML=a.map(e=>`<div class="activity-item" style="padding: 16px; border-bottom: 1px solid #e5e7eb;"><div><div style="font-weight: 600;">${y(e.type||"Transaction")}</div><div style="font-size: 14px; color: #6b7280;">${y(e.description||"")}</div></div><div style="text-align: right; color: ${e.amount>=0?"#10b981":"#ef4444"};">${e.amount>=0?"+":""}$${Math.abs(e.amount||0).toFixed(2)}</div></div>`).join("")}catch(t){e.innerHTML='<div class="empty-state" style="padding: 40px 20px; text-align: center;"><i class="ph ph-warning-circle" style="font-size: 48px; opacity: 0.5; color: #ef4444;"></i><p>Failed to load transactions</p></div>'}}();break;case"profile":!async function(){const e=document.getElementById("profile-form-container");if(!e)return;try{const t=await fetch("/api/user/profile",{credentials:"include"});if(!t.ok){if(401===t.status)return void(window.location.href="/auth/login");throw new Error(`HTTP ${t.status}`)}const n=await t.json();e.innerHTML=`<form style="max-width: 600px;"><div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Email</label><input type="email" value="${y(n.email||"")}" readonly style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb;"><small style="display: block; margin-top: 4px; color: #6b7280;">Email cannot be changed</small></div><div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">User ID</label><input type="text" value="${y(n.id||"")}" readonly style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb; font-family: monospace;"></div><div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Member Since</label><input type="text" value="${n.created_at?g(n.created_at):"N/A"}" readonly style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb;"></div></form>`}catch(t){e.innerHTML='<div class="empty-state" style="padding: 40px 20px; text-align: center;"><i class="ph ph-warning-circle" style="font-size: 48px; opacity: 0.5; color: #ef4444;"></i><p>Failed to load profile</p></div>'}}();break;case"settings":!async function(){var e,t;const a=document.getElementById("settings-form-container");if(!a)return;a.innerHTML='\n    <div style="max-width: 600px;">\n      <h3 style="margin: 0 0 24px 0;">Account Settings</h3>\n      \n      <div class="card" style="padding: 20px; margin-bottom: 20px;">\n        <h4 style="margin: 0 0 16px 0;">Notifications</h4>\n        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 12px;">\n          <input type="checkbox" id="email-notifications" checked style="margin-right: 12px; width: 18px; height: 18px;">\n          <span>Email notifications (Verification updates)</span>\n        </label>\n        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 12px;">\n          <input type="checkbox" id="payment-notifications" checked style="margin-right: 12px; width: 18px; height: 18px;">\n          <span>Payment receipts</span>\n        </label>\n      </div>\n\n      <div class="card" style="padding: 20px; margin-bottom: 20px;">\n         <h4 style="margin: 0 0 16px 0;">Privacy</h4>\n         <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 12px;">\n            <input type="checkbox" id="profile-visibility" style="margin-right: 12px;">\n            <span>Profile Visibility (Public)</span>\n         </label>\n         <label style="display: flex; align-items: center; cursor: pointer;">\n            <input type="checkbox" id="analytics-tracking" checked style="margin-right: 12px;">\n            <span>Allow Analytics</span>\n         </label>\n      </div>\n\n      <div class="card" style="padding: 20px; margin-bottom: 20px;">\n        <h4 style="margin: 0 0 16px 0;">Security</h4>\n        <button class="btn btn-secondary btn-sm" onclick="window.location.href=\'/auth/password-reset\'">\n          <i class="ph ph-lock"></i> Change Password\n        </button>\n        <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">\n             <button class="btn btn-danger btn-sm" id="delete-account-btn">Delete Account</button>\n        </div>\n      </div>\n\n      <div style="padding-top: 20px; border-top: 1px solid #e5e7eb;">\n        <button id="save-settings-btn" class="btn btn-primary">\n          <i class="ph ph-floppy-disk"></i> Save Settings\n        </button>\n      </div>\n    </div>',null==(e=document.getElementById("save-settings-btn"))||e.addEventListener("click",async()=>{const e={verification_alerts:document.getElementById("email-notifications").checked,payment_receipts:document.getElementById("payment-notifications").checked},t={profile_visibility:document.getElementById("profile-visibility").checked,analytics_tracking:document.getElementById("analytics-tracking").checked};try{const a=document.getElementById("save-settings-btn");a.innerHTML='<div class="spinner-small"></div> Saving...',a.disabled=!0,await Promise.all([n.saveSettings("notifications",e),n.saveSettings("privacy",t)]),p("Settings saved successfully","success")}catch(a){p(a.message,"error")}finally{const e=document.getElementById("save-settings-btn");e&&(e.innerHTML='<i class="ph ph-floppy-disk"></i> Save Settings',e.disabled=!1)}}),null==(t=document.getElementById("delete-account-btn"))||t.addEventListener("click",()=>{const e=prompt("Enter your password to confirm deletion:");e&&n.deleteAccount(e).then(()=>{alert("Account deleted."),window.location.href="/auth/register"}).catch(e=>p(e.message,"error"))})}()}}function A(){const t=document.getElementById("verification-modal");t&&(t.classList.add("show"),document.body.style.overflow="hidden",e.setState({verification:{step:1,areaCode:null,service:null,carrier:null,cost:0,verificationId:null,pollingInterval:null,areaCodes:[],services:[],carriers:[]}}),document.getElementById("area-code-select").value="",document.getElementById("service-select").innerHTML='<option value="">-- Select Service --</option>',document.getElementById("carrier-select").innerHTML='<option value="">-- Any Carrier --</option>',async function(){try{h("area-code-select");const e=b.get("areaCodes");let t;if(e)t=e;else{const e=await n.getAreaCodes();if(!e.success)throw new Error("Failed to load area codes");t=e,b.set("areaCodes",t,864e5)}const a=document.getElementById("area-code-select");if(a.innerHTML='<option value="">-- Select Area Code --</option>',window.tierManager&&!window.tierManager.checkFeatureAccess("area_codes"))return window.tierManager.lockFeature(a.parentElement,"area_codes","starter"),void(a.disabled=!0);t.area_codes.forEach(e=>{const t=document.createElement("option");t.value=e.area_code,t.textContent=`${e.area_code} (${e.state})`,a.appendChild(t)})}catch(e){p(o(e),"error")}finally{f("area-code-select")}}(),async function(){try{const e=b.get("carriers");let t;if(e)t=e;else{const e=await n.getCarriers();if(!e.success)throw new Error("Failed to load carriers");t=e,b.set("carriers",t,864e5)}const a=document.getElementById("carrier-select");if(a.innerHTML='<option value="">-- Any Carrier --</option>',window.tierManager&&!window.tierManager.checkFeatureAccess("isp_filter"))return window.tierManager.lockFeature(a.parentElement,"isp_filter","turbo"),void(a.disabled=!0);t.carriers.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,a.appendChild(t)})}catch(e){p(o(e),"error")}}(),U(1))}function j(){const t=document.getElementById("verification-modal");t&&(t.classList.remove("show"),document.body.style.overflow="");const n=e.getState();n.verification.pollingInterval&&clearInterval(n.verification.pollingInterval)}async function O(){const t=document.getElementById("area-code-select").value;e.setState({verification:{areaCode:t}}),S.emit(E,t),await async function(e){try{h("service-select");const t=`services_${e}`,a=b.get(t);let i;if(a)i=a;else{const a=await n.getServices(e);if(!a.success)throw new Error("Failed to load services");i=a,b.set(t,i,36e5)}const r=document.getElementById("service-select");r.innerHTML='<option value="">-- Select Service --</option>',i.services.forEach(e=>{const t=document.createElement("option");t.value=e.name,t.textContent=e.name,t.dataset.cost=e.cost||0,r.appendChild(t)})}catch(t){p(o(t),"error")}finally{f("service-select")}}(t),await q()}function F(){const t=document.getElementById("service-select").value;e.setState({verification:{service:t}}),S.emit(x,t),q()}function z(){const t=document.getElementById("carrier-select").value;e.setState({verification:{carrier:t}}),S.emit(k,t),q()}async function q(){const t=e.getState(),a=t.verification.service,i=t.verification.areaCode||"any",r=t.verification.carrier||"any";if(a)try{const t=`pricing_${a}_${i}_${r}`,o=b.get(t);let s;o?s=o:(s=await n.getPricing(a,i,r),b.set(t,s,3e5));document.getElementById("service-price").innerHTML=`\n      <div class="pricing-breakdown">\n        <div class="pricing-line">\n          <span>Base price:</span>\n          <span>$${s.base_price.toFixed(2)}</span>\n        </div>\n        ${s.area_code_premium>0?`\n          <div class="pricing-line">\n            <span>Area code premium:</span>\n            <span>+$${s.area_code_premium.toFixed(2)}</span>\n          </div>\n        `:""}\n        ${s.carrier_premium>0?`\n          <div class="pricing-line">\n            <span>Carrier premium:</span>\n            <span>+$${s.carrier_premium.toFixed(2)}</span>\n          </div>\n        `:""}\n        <div class="pricing-line total">\n          <span>Total:</span>\n          <span>$${s.total_price.toFixed(2)}</span>\n        </div>\n      </div>\n    `,e.setState({verification:{cost:s.total_price}})}catch(o){}}function U(t){const n=e.getState();if(2===t&&!n.verification.areaCode)return void p("Please select an area code","warning");if(3===t&&!n.verification.service)return void p("Please select a service","warning");e.setState({verification:{step:t}}),document.querySelectorAll(".progress-step").forEach(e=>{const n=parseInt(e.dataset.step);e.classList.remove("active","completed"),n<t&&e.classList.add("completed"),n===t&&e.classList.add("active")}),document.querySelectorAll('[id^="step"]').forEach(e=>{e.style.display="none"});const a=document.getElementById(`step${t}`);a&&(a.style.display="block")}async function N(){const t=e.getState(),{service:a,areaCode:i,carrier:r,cost:s}=t.verification,c=d({service:a,areaCode:i,carrier:r});if(!c.valid){return void p(Object.values(c.errors).join(", "),"error")}if(t.balance<s)p("Insufficient balance. Please add credits.","error");else try{S.emit(I,{service:a,areaCode:i,carrier:r});const e=await n.purchaseVerification(a,i,r);if(!e.success)throw new Error(e.detail||"Purchase failed");p("Verification purchased successfully","success"),S.emit(L,e),U(4),M()}catch(l){S.emit(T,l),p(o(l),"error")}}document.addEventListener("DOMContentLoaded",B);export{a,c as e,B as i,t as s,w as u,u as v};
//# sourceMappingURL=dashboard.CIgkGDLr.js.map
