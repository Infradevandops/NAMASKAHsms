import{T as t,H as e}from"./constants.mniaqQLw.js";import{c as s,h as r,g as o}from"./auth-store.D23SS89P.js";class i extends Error{constructor(t,e,s=null){super(t),this.name="ApiError",this.status=e,this.data=s}isUnauthorized(){return this.status===e.UNAUTHORIZED}isTimeout(){return this.status===e.TIMEOUT}isServerError(){return this.status>=500}}class n{constructor(e={}){this.baseUrl=e.baseUrl||"/api/v1",this.defaultTimeout=e.timeout||t.API_REQUEST,this.maxRetries=e.maxRetries||3,this.retryDelay=e.retryDelay||1e3,this.onUnauthorized=e.onUnauthorized||this._defaultUnauthorizedHandler}_defaultUnauthorizedHandler(){s(),window.location.href="/auth/login"}_getRetryDelay(t){return Math.min(this.retryDelay*Math.pow(2,t),1e4)}_sleep(t){return new Promise(e=>setTimeout(e,t))}async request(t,s={}){const{method:n="GET",body:a,headers:u={},timeout:h=this.defaultTimeout,retry:d=!0,maxRetries:w=this.maxRetries,requiresAuth:l=!0}=s;if(l&&!r())throw new i("No authentication token",e.UNAUTHORIZED);const c=`${this.baseUrl}${t}`;let T;for(let r=0;r<=(d?w:0);r++){if(r>0){const t=this._getRetryDelay(r-1);window.FrontendLogger&&window.FrontendLogger.info(`API retry ${r}/${w} for ${c}, waiting ${t}ms`),await this._sleep(t)}const t=new AbortController,s=setTimeout(()=>t.abort(),h);try{const h={method:n,headers:{"Content-Type":"application/json",...o(),...u},credentials:"include",signal:t.signal};a&&"GET"!==n&&(h.body="string"==typeof a?a:JSON.stringify(a)),window.FrontendLogger&&window.FrontendLogger.logApiCall(n,c);const d=await fetch(c,h);if(clearTimeout(s),window.FrontendLogger&&window.FrontendLogger.logApiResponse(n,c,d.status),d.status===e.UNAUTHORIZED)throw this.onUnauthorized(),new i("Unauthorized",e.UNAUTHORIZED);if(d.status>=400&&d.status<500&&d.status!==e.TIMEOUT&&d.status!==e.TOO_MANY_REQUESTS){const t=await d.json().catch(()=>({}));throw new i(t.detail||`HTTP ${d.status}`,d.status,t)}if(d.status>=500||d.status===e.TIMEOUT||d.status===e.TOO_MANY_REQUESTS){if(T=new i(`HTTP ${d.status}`,d.status),r<w)continue;throw T}const l=d.headers.get("content-type");return l&&l.includes("application/json")?await d.json():await d.text()}catch(m){if(clearTimeout(s),"AbortError"===m.name){if(T=new i("Request timeout",e.TIMEOUT),r<w)continue;throw T}if(m instanceof i)throw m;if(T=new i(m.message||"Network error",0),r<w)continue;throw T}}throw T}get(t,e={}){return this.request(t,{...e,method:"GET"})}post(t,e,s={}){return this.request(t,{...s,method:"POST",body:e})}put(t,e,s={}){return this.request(t,{...s,method:"PUT",body:e})}patch(t,e,s={}){return this.request(t,{...s,method:"PATCH",body:e})}delete(t,e={}){return this.request(t,{...e,method:"DELETE"})}}const a=new n;"undefined"!=typeof window&&(window.ApiClient=n,window.ApiError=i,window.api=a);
//# sourceMappingURL=api-client.Bg95hxbA.js.map
