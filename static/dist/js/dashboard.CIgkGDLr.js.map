{"version":3,"file":"dashboard.CIgkGDLr.js","sources":["../../js/modules/state.js","../../js/modules/api.js","../../js/modules/errors.js","../../js/modules/validation.js","../../js/modules/ui.js","../../js/utils/cache.js","../../js/utils/events.js","../../js/dashboard.js"],"sourcesContent":["/**\n * State Management Module\n * Single source of truth for application state\n */\n\nclass StateManager {\n  constructor() {\n    this.state = {\n      user: null,\n      balance: 0,\n      currentView: 'home',\n      verification: {\n        step: 1,\n        areaCode: null,\n        service: null,\n        carrier: null,\n        cost: 0,\n        verificationId: null,\n        pollingInterval: null,\n        areaCodes: [],\n        services: [],\n        carriers: []\n      }\n    };\n    this.listeners = [];\n  }\n\n  /**\n   * Update state with new values\n   * @param {Object} updates - Partial state updates\n   * @returns {void}\n   */\n  setState(updates) {\n    this.state = { ...this.state, ...updates };\n    this.notify();\n  }\n\n  /**\n   * Subscribe to state changes\n   * @param {Function} listener - Callback function\n   * @returns {void}\n   */\n  subscribe(listener) {\n    this.listeners.push(listener);\n  }\n\n  /**\n   * Unsubscribe from state changes\n   * @param {Function} listener - Callback function\n   * @returns {void}\n   */\n  unsubscribe(listener) {\n    this.listeners = this.listeners.filter(l => l !== listener);\n  }\n\n  /**\n   * Notify all listeners of state change\n   * @returns {void}\n   */\n  notify() {\n    this.listeners.forEach(listener => listener(this.state));\n  }\n\n  /**\n   * Get current state\n   * @returns {Object} Current state\n   */\n  getState() {\n    return this.state;\n  }\n}\n\nexport const stateManager = new StateManager();\n","/**\n * API Layer Module\n * Centralized API calls with error handling\n */\n\nexport const api = {\n  /**\n   * Get all countries (USA only)\n   * @async\n   * @returns {Promise<Object>} Countries data\n   */\n  async getCountries() {\n    try {\n      const response = await fetch('/api/countries/');\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to fetch countries:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get US area codes\n   * @async\n   * @returns {Promise<Object>} Area codes data\n   */\n  async getAreaCodes() {\n    try {\n      const response = await fetch('/api/countries/usa/area-codes');\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to fetch area codes:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get services for area code\n   * @async\n   * @param {string} areaCode - Area code\n   * @returns {Promise<Object>} Services data\n   */\n  async getServices(areaCode) {\n    try {\n      const params = new URLSearchParams({ areaCode: areaCode || 'any' });\n      const response = await fetch(`/api/countries/usa/services?${params}`);\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to fetch services:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get available carriers\n   * @async\n   * @returns {Promise<Object>} Carriers data\n   */\n  async getCarriers() {\n    try {\n      const response = await fetch('/api/countries/usa/carriers');\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to fetch carriers:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get pricing for verification\n   * @async\n   * @param {string} service - Service name\n   * @param {string} areaCode - Area code\n   * @param {string} carrier - Carrier name\n   * @returns {Promise<Object>} Pricing data\n   */\n  async getPricing(service, areaCode, carrier) {\n    try {\n      const params = new URLSearchParams({\n        service,\n        area_code: areaCode || 'any',\n        carrier: carrier || 'any'\n      });\n      const response = await fetch(`/api/verification/pricing?${params}`);\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to fetch pricing:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Purchase verification\n   * @async\n   * @param {string} service - Service name\n   * @param {string} areaCode - Area code\n   * @param {string} carrier - Carrier name\n   * @returns {Promise<Object>} Purchase result\n   */\n  async purchaseVerification(service, areaCode, carrier) {\n    try {\n      const response = await fetch('/api/verification/purchase', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ service, area_code: areaCode, carrier })\n      });\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to purchase verification:', error);\n      throw error;\n    }\n  },\n  /**\n   * Initialize payment\n   * @async\n   * @param {number} amount_usd - Amount in USD\n   * @returns {Promise<Object>} Payment data with authorization_url\n   */\n  async initializePayment(amount_usd) {\n    try {\n      const response = await fetch('/api/billing/initialize-payment', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ amount_usd })\n      });\n      // 503 means Service Unavailable (Paystack not configured), handle gracefully\n      if (response.status === 503) {\n        throw new Error('Payment gateway unavailable. Please contact support.');\n      }\n      if (!response.ok) {\n        const err = await response.json();\n        throw new Error(err.detail || `HTTP ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to initialize payment:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Save user settings\n   * @async\n   * @param {string} type - 'notifications', 'privacy', or 'billing'\n   * @param {Object} data - Settings data\n   * @returns {Promise<Object>} Result\n   */\n  async saveSettings(type, data) {\n    try {\n      const response = await fetch(`/api/user/settings/${type}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data)\n      });\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to save settings:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Logout all devices\n   * @async\n   * @returns {Promise<Object>} Result\n   */\n  async logoutAll() {\n    try {\n      const response = await fetch('/api/user/logout-all', { method: 'POST' });\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (e) { throw e; }\n  },\n\n  /**\n   * Delete account\n   * @async\n   * @param {string} password - User password\n   * @returns {Promise<Object>} Result\n   */\n  async deleteAccount(password) {\n    try {\n      const response = await fetch('/api/user/delete-account', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ password })\n      });\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      return await response.json();\n    } catch (e) { throw e; }\n  }\n};\n","/**\n * Error Handling Module\n * Structured error handling with specific messages\n */\n\nexport class APIError extends Error {\n  constructor(status, message) {\n    super(message);\n    this.status = status;\n    this.name = 'APIError';\n  }\n}\n\nexport const errorMessages = {\n  400: 'Invalid request. Please check your input.',\n  401: 'Session expired. Please login again.',\n  402: 'Insufficient balance. Please add credits.',\n  404: 'Resource not found.',\n  429: 'Too many requests. Please wait a moment.',\n  500: 'Server error. Please try again later.',\n  503: 'Service unavailable. Please try again later.'\n};\n\n/**\n * Handle API errors\n * @param {Error} error - Error object\n * @returns {string} Error message\n */\nexport function handleError(error) {\n  if (error instanceof APIError) {\n    return errorMessages[error.status] || 'An error occurred';\n  }\n  if (error.message) {\n    return error.message;\n  }\n  return 'Unknown error occurred';\n}\n\n/**\n * Log error with context\n * @param {string} context - Error context\n * @param {Error} error - Error object\n * @returns {void}\n */\nexport function logError(context, error) {\n  console.error(`[${context}]`, error);\n}\n","/**\n * Validation Module\n * Input validation for verification flow\n */\n\nexport const validators = {\n  /**\n   * Validate area code\n   * @param {string} value - Area code value\n   * @returns {Object} Validation result\n   */\n  areaCode(value) {\n    if (!value) return { valid: false, error: 'Area code required' };\n    if (!/^\\d{3}$/.test(value)) return { valid: false, error: 'Invalid area code format' };\n    return { valid: true };\n  },\n\n  /**\n   * Validate service\n   * @param {string} value - Service value\n   * @returns {Object} Validation result\n   */\n  service(value) {\n    if (!value) return { valid: false, error: 'Service required' };\n    if (typeof value !== 'string') return { valid: false, error: 'Invalid service' };\n    return { valid: true };\n  },\n\n  /**\n   * Validate carrier\n   * @param {string} value - Carrier value\n   * @returns {Object} Validation result\n   */\n  carrier(value) {\n    if (!value) return { valid: true }; // Optional\n    if (typeof value !== 'string') return { valid: false, error: 'Invalid carrier' };\n    return { valid: true };\n  }\n};\n\n/**\n * Validate verification data\n * @param {Object} data - Verification data\n * @returns {Object} Validation result with errors\n */\nexport function validateVerification(data) {\n  const errors = {};\n\n  const areaCodeValidation = validators.areaCode(data.areaCode);\n  if (!areaCodeValidation.valid) errors.areaCode = areaCodeValidation.error;\n\n  const serviceValidation = validators.service(data.service);\n  if (!serviceValidation.valid) errors.service = serviceValidation.error;\n\n  const carrierValidation = validators.carrier(data.carrier);\n  if (!carrierValidation.valid) errors.carrier = carrierValidation.error;\n\n  return {\n    valid: Object.keys(errors).length === 0,\n    errors\n  };\n}\n","/**\n * UI Helpers Module\n * Common UI functions\n */\n\n/**\n * Show toast notification\n * @param {string} message - Message text\n * @param {string} type - Type (success, error, warning, info)\n * @returns {void}\n */\nexport function showToast(message, type = 'info') {\n  const toast = document.createElement('div');\n  toast.className = `toast toast-${type}`;\n  toast.textContent = message;\n  document.body.appendChild(toast);\n\n  setTimeout(() => toast.remove(), 3000);\n}\n\n/**\n * Hide all modals\n * @returns {void}\n */\nexport function hideModals() {\n  document.querySelectorAll('.modal').forEach(modal => {\n    modal.classList.remove('show');\n  });\n  document.body.style.overflow = '';\n}\n\n/**\n * Escape HTML special characters\n * @param {string} text - Text to escape\n * @returns {string} Escaped text\n */\nexport function escapeHtml(text) {\n  const map = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\n/**\n * Format date\n * @param {string} dateString - Date string\n * @returns {string} Formatted date\n */\nexport function formatDate(dateString) {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  });\n}\n\n/**\n * Update balance display\n * @param {number} balance - Balance amount\n * @returns {void}\n */\nexport function updateBalanceDisplay(balance) {\n  const formatted = `$${balance.toFixed(2)}`;\n  const elements = [\n    document.getElementById('header-balance'),\n    document.getElementById('stat-balance'),\n    document.getElementById('wallet-balance')\n  ];\n  elements.forEach(el => {\n    if (el) el.textContent = formatted;\n  });\n}\n\n/**\n * Show loading state\n * @param {string} elementId - Element ID\n * @returns {void}\n */\nexport function showLoading(elementId) {\n  const el = document.getElementById(elementId);\n  if (el) el.classList.add('loading');\n}\n\n/**\n * Hide loading state\n * @param {string} elementId - Element ID\n * @returns {void}\n */\nexport function hideLoading(elementId) {\n  const el = document.getElementById(elementId);\n  if (el) el.classList.remove('loading');\n}\n","/**\n * Cache Module\n * Smart caching with TTL\n */\n\nexport class Cache {\n  constructor(ttl = 3600000) { // 1 hour default\n    this.data = new Map();\n    this.ttl = ttl;\n  }\n\n  /**\n   * Set cache value with TTL\n   * @param {string} key - Cache key\n   * @param {*} value - Cache value\n   * @param {number} ttl - Time to live in ms\n   * @returns {void}\n   */\n  set(key, value, ttl = this.ttl) {\n    this.data.set(key, {\n      value,\n      expires: Date.now() + ttl\n    });\n  }\n\n  /**\n   * Get cache value\n   * @param {string} key - Cache key\n   * @returns {*} Cache value or null\n   */\n  get(key) {\n    const item = this.data.get(key);\n    if (!item) return null;\n\n    if (Date.now() > item.expires) {\n      this.data.delete(key);\n      return null;\n    }\n\n    return item.value;\n  }\n\n  /**\n   * Clear all cache\n   * @returns {void}\n   */\n  clear() {\n    this.data.clear();\n  }\n\n  /**\n   * Check if key exists and not expired\n   * @param {string} key - Cache key\n   * @returns {boolean} True if valid\n   */\n  has(key) {\n    return this.get(key) !== null;\n  }\n}\n\nexport const cache = new Cache();\n","/**\n * Event Bus Module\n * Loose coupling between components\n */\n\nexport const events = {\n  AREA_CODE_CHANGED: 'areaCodeChanged',\n  SERVICE_CHANGED: 'serviceChanged',\n  CARRIER_CHANGED: 'carrierChanged',\n  VERIFICATION_STARTED: 'verificationStarted',\n  VERIFICATION_COMPLETED: 'verificationCompleted',\n  ERROR_OCCURRED: 'errorOccurred'\n};\n\nexport class EventBus {\n  constructor() {\n    this.listeners = new Map();\n  }\n\n  /**\n   * Subscribe to event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   * @returns {void}\n   */\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n  }\n\n  /**\n   * Emit event\n   * @param {string} event - Event name\n   * @param {*} data - Event data\n   * @returns {void}\n   */\n  emit(event, data) {\n    if (this.listeners.has(event)) {\n      this.listeners.get(event).forEach(callback => callback(data));\n    }\n  }\n\n  /**\n   * Unsubscribe from event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   * @returns {void}\n   */\n  off(event, callback) {\n    if (this.listeners.has(event)) {\n      const callbacks = this.listeners.get(event);\n      const index = callbacks.indexOf(callback);\n      if (index > -1) callbacks.splice(index, 1);\n    }\n  }\n}\n\nexport const eventBus = new EventBus();\n","/**\n * Namaskah Dashboard - Refactored Main Entry Point\n * Uses modular architecture with StateManager, API layer, and event bus\n */\n\nimport { stateManager } from './modules/state.js';\nimport { api } from './modules/api.js';\nimport { handleError, logError } from './modules/errors.js';\nimport { validateVerification } from './modules/validation.js';\nimport { showToast, hideModals, escapeHtml, formatDate, updateBalanceDisplay, showLoading, hideLoading } from './modules/ui.js';\nimport { cache } from './utils/cache.js';\nimport { eventBus, events } from './utils/events.js';\n\n// Initialize on DOM ready\ndocument.addEventListener('DOMContentLoaded', init);\n\n/**\n * Initialize dashboard\n * @returns {void}\n */\nexport function init() {\n  setupEventListeners();\n  setupOfflineDetection();\n  hideModals();\n  setupViewSwitching();\n\n  // Load recent activity\n  loadRecentActivity();\n\n  // Load user data with error handling\n  loadUserData().catch(err => {\n    console.error('Failed to load user data:', err);\n    showToast('Could not load user profile. Using defaults.', 'warning');\n  });\n\n  loadBalance().catch(err => {\n    console.error('Failed to load balance:', err);\n    showToast('Could not load balance. Please refresh.', 'warning');\n  });\n}\n\n/**\n * Setup event listeners\n * @returns {void}\n */\nfunction setupEventListeners() {\n  // Sidebar toggle\n  const sidebarToggle = document.getElementById('sidebar-toggle');\n  if (sidebarToggle) {\n    sidebarToggle.addEventListener('click', toggleSidebar);\n  }\n\n  // User menu\n  const userAvatarBtn = document.getElementById('user-avatar-btn');\n  if (userAvatarBtn) {\n    userAvatarBtn.addEventListener('click', toggleUserDropdown);\n  }\n\n  // Close dropdown when clicking outside\n  document.addEventListener('click', function (e) {\n    const dropdown = document.getElementById('user-dropdown');\n    const avatarBtn = document.getElementById('user-avatar-btn');\n    if (dropdown && !dropdown.contains(e.target) && !avatarBtn.contains(e.target)) {\n      dropdown.classList.remove('show');\n    }\n  });\n\n  // Logout buttons\n  document.getElementById('logout-btn')?.addEventListener('click', handleLogout);\n  document.getElementById('dropdown-logout')?.addEventListener('click', handleLogout);\n\n  // Verification modal\n  document.getElementById('new-verification-btn')?.addEventListener('click', openVerificationModal);\n  document.getElementById('quick-verification-btn')?.addEventListener('click', openVerificationModal);\n  document.getElementById('verification-close-btn')?.addEventListener('click', closeVerificationModal);\n  document.getElementById('step1-cancel')?.addEventListener('click', closeVerificationModal);\n  document.getElementById('step1-next')?.addEventListener('click', () => goToVerificationStep(2));\n  document.getElementById('step2-back')?.addEventListener('click', () => goToVerificationStep(1));\n  document.getElementById('step2-next')?.addEventListener('click', () => goToVerificationStep(3));\n  document.getElementById('step3-back')?.addEventListener('click', () => goToVerificationStep(2));\n  document.getElementById('step3-purchase')?.addEventListener('click', purchaseVerification);\n  document.getElementById('step4-close')?.addEventListener('click', closeVerificationModal);\n\n  // Area code and service selects\n  document.getElementById('area-code-select')?.addEventListener('change', onAreaCodeChange);\n  document.getElementById('service-select')?.addEventListener('change', onServiceChange);\n  document.getElementById('carrier-select')?.addEventListener('change', onCarrierChange);\n\n  // Close modals on Escape key\n  document.addEventListener('keydown', function (e) {\n    if (e.key === 'Escape') {\n      hideModals();\n    }\n  });\n\n  // Refresh balance on window focus\n  window.addEventListener('focus', loadBalance);\n\n  setupCreditHandlers();\n  setupRentalHandlers();\n}\n\n/**\n * Setup offline detection\n * @returns {void}\n */\nfunction setupOfflineDetection() {\n  window.addEventListener('online', () => {\n    showToast('Back online! Syncing data...', 'success');\n    loadUserData();\n    loadBalance();\n  });\n\n  window.addEventListener('offline', () => {\n    showToast('You are offline. Some features may not work.', 'warning');\n  });\n\n  if (!navigator.onLine) {\n    showToast('You are offline. Some features may not work.', 'warning');\n  }\n}\n\n/**\n * Toggle sidebar\n * @returns {void}\n */\nfunction toggleSidebar() {\n  const sidebar = document.getElementById('sidebar');\n  if (sidebar) {\n    sidebar.classList.toggle('collapsed');\n    localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));\n  }\n}\n\n/**\n * Toggle user dropdown\n * @returns {void}\n */\nfunction toggleUserDropdown() {\n  const dropdown = document.getElementById('user-dropdown');\n  if (dropdown) {\n    dropdown.classList.toggle('show');\n  }\n}\n\n/**\n * Load user data\n * @async\n * @returns {void}\n */\nasync function loadUserData() {\n  try {\n    // Set a timeout to prevent hanging (increased to 10s)\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 10000);\n\n    const response = await fetch('/api/user/profile', {\n      signal: controller.signal\n    });\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      if (response.status === 401) {\n        showToast('Session expired. Redirecting to login...', 'warning');\n        setTimeout(() => window.location.href = '/auth/login', 1500);\n        return;\n      }\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n    const user = await response.json();\n    stateManager.setState({ user });\n\n    const emailEl = document.getElementById('dropdown-email');\n    const initialsEl = document.getElementById('user-initials');\n\n    if (emailEl) emailEl.textContent = user.email || 'User';\n    if (initialsEl) {\n      const initials = (user.email || 'U').charAt(0).toUpperCase();\n      initialsEl.textContent = initials;\n    }\n  } catch (error) {\n    logError('loadUserData', error);\n\n    // Set default user display if endpoint fails\n    const emailEl = document.getElementById('dropdown-email');\n    const initialsEl = document.getElementById('user-initials');\n    if (emailEl) emailEl.textContent = 'User';\n    if (initialsEl) initialsEl.textContent = 'U';\n\n    // Only show error if it's not an abort (timeout is expected if server is down)\n    if (error.name !== 'AbortError') {\n      console.warn('Could not load user profile:', error.message);\n    }\n  }\n}\n\n/**\n * Handle logout\n * @async\n * @param {Event} e - Event object\n * @returns {void}\n */\nasync function handleLogout(e) {\n  e.preventDefault();\n  if (!confirm('Are you sure you want to logout?')) return;\n\n  try {\n    await fetch('/api/auth/logout', { method: 'POST' });\n  } catch (error) {\n    logError('handleLogout', error);\n  }\n  localStorage.clear();\n  window.location.href = '/auth/login';\n}\n\n/**\n * Load balance\n * @async\n * @returns {void}\n */\nasync function loadBalance() {\n  try {\n    // Set a timeout to prevent hanging (increased to 10s)\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 10000);\n\n    const response = await fetch('/api/user/balance', {\n      headers: { 'Cache-Control': 'no-cache' },\n      signal: controller.signal\n    });\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      if (response.status === 401) {\n        showToast('Session expired. Redirecting to login...', 'warning');\n        setTimeout(() => window.location.href = '/auth/login', 1500);\n        return;\n      }\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n    const data = await response.json();\n    const balance = parseFloat(data.credits) || 0;\n    stateManager.setState({ balance });\n    updateBalanceDisplay(balance);\n  } catch (error) {\n    logError('loadBalance', error);\n\n    // Set default balance if endpoint fails\n    updateBalanceDisplay(0);\n\n    // Only show error if it's not an abort\n    if (error.name !== 'AbortError') {\n      console.warn('Could not load balance:', error.message);\n    }\n  }\n}\n\n/**\n * Setup view switching\n * @returns {void}\n */\nfunction setupViewSwitching() {\n  const urlParams = new URLSearchParams(window.location.search);\n  const view = urlParams.get('view') || 'home';\n  switchView(view);\n\n  document.querySelectorAll('.nav-item[data-view]').forEach(item => {\n    item.addEventListener('click', function (e) {\n      e.preventDefault();\n      const targetView = this.getAttribute('data-view');\n      switchView(targetView);\n      updateURL(targetView);\n    });\n  });\n\n  if (localStorage.getItem('sidebarCollapsed') === 'true') {\n    document.getElementById('sidebar')?.classList.add('collapsed');\n  }\n}\n\n/**\n * Switch view\n * @param {string} viewName - View name\n * @returns {void}\n */\nfunction switchView(viewName) {\n  stateManager.setState({ currentView: viewName });\n\n  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));\n  const targetView = document.getElementById(`${viewName}-view`);\n  if (targetView) {\n    targetView.classList.add('active');\n  }\n\n  document.querySelectorAll('.nav-item').forEach(item => {\n    item.classList.remove('active');\n    if (item.getAttribute('data-view') === viewName) {\n      item.classList.add('active');\n    }\n  });\n\n  // Initialize view content\n  switch (viewName) {\n    case 'rentals':\n      loadRentalsView();\n      break;\n    case 'wallet':\n      loadWalletView();\n      break;\n    case 'profile':\n      loadProfileView();\n      break;\n    case 'settings':\n      loadSettingsView();\n      break;\n  }\n}\n\n/**\n * Update URL\n * @param {string} view - View name\n * @returns {void}\n */\nfunction updateURL(view) {\n  const url = view === 'home' ? '/dashboard' : `/dashboard?view=${view}`;\n  window.history.pushState({ view }, '', url);\n}\n\n/**\n * Open verification modal\n * @returns {void}\n */\nfunction openVerificationModal() {\n  const modal = document.getElementById('verification-modal');\n  if (modal) {\n    modal.classList.add('show');\n    document.body.style.overflow = 'hidden';\n    resetVerificationState();\n    loadAreaCodes();\n    loadCarriers();\n    goToVerificationStep(1);\n  }\n}\n\n/**\n * Close verification modal\n * @returns {void}\n */\nfunction closeVerificationModal() {\n  const modal = document.getElementById('verification-modal');\n  if (modal) {\n    modal.classList.remove('show');\n    document.body.style.overflow = '';\n  }\n\n  const state = stateManager.getState();\n  if (state.verification.pollingInterval) {\n    clearInterval(state.verification.pollingInterval);\n  }\n}\n\n/**\n * Reset verification state\n * @returns {void}\n */\nfunction resetVerificationState() {\n  stateManager.setState({\n    verification: {\n      step: 1,\n      areaCode: null,\n      service: null,\n      carrier: null,\n      cost: 0,\n      verificationId: null,\n      pollingInterval: null,\n      areaCodes: [],\n      services: [],\n      carriers: []\n    }\n  });\n\n  document.getElementById('area-code-select').value = '';\n  document.getElementById('service-select').innerHTML = '<option value=\"\">-- Select Service --</option>';\n  document.getElementById('carrier-select').innerHTML = '<option value=\"\">-- Any Carrier --</option>';\n}\n\n/**\n * Load area codes\n * @async\n * @returns {void}\n */\nasync function loadAreaCodes() {\n  try {\n    showLoading('area-code-select');\n\n    const cached = cache.get('areaCodes');\n    let data;\n\n    if (cached) {\n      data = cached;\n    } else {\n      const response = await api.getAreaCodes();\n      if (!response.success) throw new Error('Failed to load area codes');\n      data = response;\n      cache.set('areaCodes', data, 86400000); // 24 hours\n    }\n\n    const select = document.getElementById('area-code-select');\n    select.innerHTML = '<option value=\"\">-- Select Area Code --</option>';\n\n    // Check tier access\n    if (window.tierManager && !window.tierManager.checkFeatureAccess('area_codes')) {\n      window.tierManager.lockFeature(select.parentElement, 'area_codes', 'starter');\n      select.disabled = true;\n      return;\n    }\n\n    data.area_codes.forEach(code => {\n      const option = document.createElement('option');\n      option.value = code.area_code;\n      option.textContent = `${code.area_code} (${code.state})`;\n      select.appendChild(option);\n    });\n\n    console.log(`Loaded ${data.area_codes.length} area codes`);\n  } catch (error) {\n    logError('loadAreaCodes', error);\n    showToast(handleError(error), 'error');\n  } finally {\n    hideLoading('area-code-select');\n  }\n}\n\n/**\n * Load carriers\n * @async\n * @returns {void}\n */\nasync function loadCarriers() {\n  try {\n    const cached = cache.get('carriers');\n    let data;\n\n    if (cached) {\n      data = cached;\n    } else {\n      const response = await api.getCarriers();\n      if (!response.success) throw new Error('Failed to load carriers');\n      data = response;\n      cache.set('carriers', data, 86400000); // 24 hours\n    }\n\n    const select = document.getElementById('carrier-select');\n    select.innerHTML = '<option value=\"\">-- Any Carrier --</option>';\n\n    // Check tier access\n    if (window.tierManager && !window.tierManager.checkFeatureAccess('isp_filter')) {\n      window.tierManager.lockFeature(select.parentElement, 'isp_filter', 'turbo');\n      select.disabled = true;\n      return;\n    }\n\n    data.carriers.forEach(carrier => {\n      const option = document.createElement('option');\n      option.value = carrier.id;\n      option.textContent = carrier.name;\n      select.appendChild(option);\n    });\n\n    console.log(`Loaded ${data.carriers.length} carriers`);\n  } catch (error) {\n    logError('loadCarriers', error);\n    showToast(handleError(error), 'error');\n  }\n}\n\n/**\n * Handle area code change\n * @async\n * @returns {void}\n */\nasync function onAreaCodeChange() {\n  const areaCode = document.getElementById('area-code-select').value;\n  stateManager.setState({ verification: { areaCode } });\n  eventBus.emit(events.AREA_CODE_CHANGED, areaCode);\n\n  await loadServices(areaCode);\n  await updatePricing();\n}\n\n/**\n * Load services\n * @async\n * @param {string} areaCode - Area code\n * @returns {void}\n */\nasync function loadServices(areaCode) {\n  try {\n    showLoading('service-select');\n\n    const cacheKey = `services_${areaCode}`;\n    const cached = cache.get(cacheKey);\n    let data;\n\n    if (cached) {\n      data = cached;\n    } else {\n      const response = await api.getServices(areaCode);\n      if (!response.success) throw new Error('Failed to load services');\n      data = response;\n      cache.set(cacheKey, data, 3600000); // 1 hour\n    }\n\n    const select = document.getElementById('service-select');\n    select.innerHTML = '<option value=\"\">-- Select Service --</option>';\n\n    data.services.forEach(service => {\n      const option = document.createElement('option');\n      option.value = service.name;\n      option.textContent = service.name;\n      option.dataset.cost = service.cost || 0;\n      select.appendChild(option);\n    });\n\n    console.log(`Loaded ${data.services.length} services`);\n  } catch (error) {\n    logError('loadServices', error);\n    showToast(handleError(error), 'error');\n  } finally {\n    hideLoading('service-select');\n  }\n}\n\n/**\n * Handle service change\n * @returns {void}\n */\nfunction onServiceChange() {\n  const service = document.getElementById('service-select').value;\n  stateManager.setState({ verification: { service } });\n  eventBus.emit(events.SERVICE_CHANGED, service);\n  updatePricing();\n}\n\n/**\n * Handle carrier change\n * @returns {void}\n */\nfunction onCarrierChange() {\n  const carrier = document.getElementById('carrier-select').value;\n  stateManager.setState({ verification: { carrier } });\n  eventBus.emit(events.CARRIER_CHANGED, carrier);\n  updatePricing();\n}\n\n/**\n * Update pricing\n * @async\n * @returns {void}\n */\nasync function updatePricing() {\n  const state = stateManager.getState();\n  const service = state.verification.service;\n  const areaCode = state.verification.areaCode || 'any';\n  const carrier = state.verification.carrier || 'any';\n\n  if (!service) return;\n\n  try {\n    const cacheKey = `pricing_${service}_${areaCode}_${carrier}`;\n    const cached = cache.get(cacheKey);\n    let pricing;\n\n    if (cached) {\n      pricing = cached;\n    } else {\n      pricing = await api.getPricing(service, areaCode, carrier);\n      cache.set(cacheKey, pricing, 300000); // 5 minutes\n    }\n\n    const priceEl = document.getElementById('service-price');\n    priceEl.innerHTML = `\n      <div class=\"pricing-breakdown\">\n        <div class=\"pricing-line\">\n          <span>Base price:</span>\n          <span>$${pricing.base_price.toFixed(2)}</span>\n        </div>\n        ${pricing.area_code_premium > 0 ? `\n          <div class=\"pricing-line\">\n            <span>Area code premium:</span>\n            <span>+$${pricing.area_code_premium.toFixed(2)}</span>\n          </div>\n        ` : ''}\n        ${pricing.carrier_premium > 0 ? `\n          <div class=\"pricing-line\">\n            <span>Carrier premium:</span>\n            <span>+$${pricing.carrier_premium.toFixed(2)}</span>\n          </div>\n        ` : ''}\n        <div class=\"pricing-line total\">\n          <span>Total:</span>\n          <span>$${pricing.total_price.toFixed(2)}</span>\n        </div>\n      </div>\n    `;\n\n    stateManager.setState({ verification: { cost: pricing.total_price } });\n  } catch (error) {\n    logError('updatePricing', error);\n  }\n}\n\n/**\n * Go to verification step\n * @param {number} step - Step number\n * @returns {void}\n */\nfunction goToVerificationStep(step) {\n  const state = stateManager.getState();\n\n  if (step === 2 && !state.verification.areaCode) {\n    showToast('Please select an area code', 'warning');\n    return;\n  }\n  if (step === 3 && !state.verification.service) {\n    showToast('Please select a service', 'warning');\n    return;\n  }\n\n  stateManager.setState({ verification: { step } });\n\n  document.querySelectorAll('.progress-step').forEach(el => {\n    const s = parseInt(el.dataset.step);\n    el.classList.remove('active', 'completed');\n    if (s < step) el.classList.add('completed');\n    if (s === step) el.classList.add('active');\n  });\n\n  document.querySelectorAll('[id^=\"step\"]').forEach(el => {\n    el.style.display = 'none';\n  });\n  const stepEl = document.getElementById(`step${step}`);\n  if (stepEl) stepEl.style.display = 'block';\n}\n\n/**\n * Purchase verification\n * @async\n * @returns {void}\n */\nasync function purchaseVerification() {\n  const state = stateManager.getState();\n  const { service, areaCode, carrier, cost } = state.verification;\n\n  const validation = validateVerification({ service, areaCode, carrier });\n  if (!validation.valid) {\n    const errors = Object.values(validation.errors).join(', ');\n    showToast(errors, 'error');\n    return;\n  }\n\n  if (state.balance < cost) {\n    showToast('Insufficient balance. Please add credits.', 'error');\n    return;\n  }\n\n  try {\n    eventBus.emit(events.VERIFICATION_STARTED, { service, areaCode, carrier });\n    const result = await api.purchaseVerification(service, areaCode, carrier);\n\n    if (result.success) {\n      showToast('Verification purchased successfully', 'success');\n      eventBus.emit(events.VERIFICATION_COMPLETED, result);\n      goToVerificationStep(4);\n      loadBalance();\n    } else {\n      throw new Error(result.detail || 'Purchase failed');\n    }\n  } catch (error) {\n    logError('purchaseVerification', error);\n    eventBus.emit(events.ERROR_OCCURRED, error);\n    showToast(handleError(error), 'error');\n  }\n}\n\n/**\n * Load Rentals View\n */\nasync function loadRentalsView() {\n  const rentalsListEl = document.getElementById('rentals-list');\n  if (!rentalsListEl) return;\n\n  try {\n    const response = await fetch('/api/rentals');\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n    const data = await response.json();\n    const rentals = data.rentals || data || [];\n\n    if (rentals.length === 0) {\n      rentalsListEl.innerHTML = '<div class=\"empty-state\" style=\"padding: 60px 20px; text-align: center;\"><i class=\"ph ph-phone\" style=\"font-size: 64px; opacity: 0.3; display: block; margin-bottom: 16px;\"></i><h3 style=\"margin: 0 0 8px 0;\">No Active Rentals</h3><p style=\"color: var(--gray-500); margin: 0;\">You don\\'t have any active phone rentals yet.</p></div>';\n    } else {\n      rentalsListEl.innerHTML = rentals.map(r => `<div class=\"activity-item\" style=\"padding: 16px; border-bottom: 1px solid #e5e7eb;\"><div><div style=\"font-weight: 600;\">${escapeHtml(r.phone_number || 'N/A')}</div><div style=\"font-size: 14px; color: #6b7280;\">${escapeHtml(r.service_name || 'Unknown')}</div></div><div style=\"text-align: right;\"><div style=\"font-weight: 600;\">$${(r.cost || 0).toFixed(2)}</div></div></div>`).join('');\n    }\n  } catch (error) {\n    logError('loadRentalsView', error);\n    rentalsListEl.innerHTML = '<div class=\"empty-state\" style=\"padding: 40px 20px; text-align: center;\"><i class=\"ph ph-warning-circle\" style=\"font-size: 48px; opacity: 0.5; color: #ef4444;\"></i><p>Failed to load rentals</p></div>';\n  }\n}\n\n/**\n * Load Wallet View\n */\nasync function loadWalletView() {\n  const transactionsListEl = document.getElementById('transactions-list');\n  if (!transactionsListEl) return;\n\n  try {\n    const response = await fetch('/api/wallet/transactions');\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n    const data = await response.json();\n    const transactions = data.transactions || data || [];\n\n    if (transactions.length === 0) {\n      transactionsListEl.innerHTML = '<div class=\"empty-state\" style=\"padding: 60px 20px; text-align: center;\"><i class=\"ph ph-receipt\" style=\"font-size: 64px; opacity: 0.3; display: block; margin-bottom: 16px;\"></i><h3 style=\"margin: 0 0 8px 0;\">No Transactions</h3><p style=\"color: var(--gray-500); margin: 0;\">Your transaction history will appear here.</p></div>';\n    } else {\n      transactionsListEl.innerHTML = transactions.map(tx => `<div class=\"activity-item\" style=\"padding: 16px; border-bottom: 1px solid #e5e7eb;\"><div><div style=\"font-weight: 600;\">${escapeHtml(tx.type || 'Transaction')}</div><div style=\"font-size: 14px; color: #6b7280;\">${escapeHtml(tx.description || '')}</div></div><div style=\"text-align: right; color: ${tx.amount >= 0 ? '#10b981' : '#ef4444'};\">${tx.amount >= 0 ? '+' : ''}$${Math.abs(tx.amount || 0).toFixed(2)}</div></div>`).join('');\n    }\n  } catch (error) {\n    logError('loadWalletView', error);\n    transactionsListEl.innerHTML = '<div class=\"empty-state\" style=\"padding: 40px 20px; text-align: center;\"><i class=\"ph ph-warning-circle\" style=\"font-size: 48px; opacity: 0.5; color: #ef4444;\"></i><p>Failed to load transactions</p></div>';\n  }\n}\n\n/**\n * Load Profile View\n */\nasync function loadProfileView() {\n  const profileContainerEl = document.getElementById('profile-form-container');\n  if (!profileContainerEl) return;\n\n  try {\n    const response = await fetch('/api/user/profile', {\n      credentials: 'include'\n    });\n    if (!response.ok) {\n      if (response.status === 401) {\n        window.location.href = '/auth/login';\n        return;\n      }\n      throw new Error(`HTTP ${response.status}`);\n    }\n    const user = await response.json();\n    profileContainerEl.innerHTML = `<form style=\"max-width: 600px;\"><div style=\"margin-bottom: 20px;\"><label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Email</label><input type=\"email\" value=\"${escapeHtml(user.email || '')}\" readonly style=\"width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\"><small style=\"display: block; margin-top: 4px; color: #6b7280;\">Email cannot be changed</small></div><div style=\"margin-bottom: 20px;\"><label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">User ID</label><input type=\"text\" value=\"${escapeHtml(user.id || '')}\" readonly style=\"width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb; font-family: monospace;\"></div><div style=\"margin-bottom: 20px;\"><label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Member Since</label><input type=\"text\" value=\"${user.created_at ? formatDate(user.created_at) : 'N/A'}\" readonly style=\"width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\"></div></form>`;\n  } catch (error) {\n    logError('loadProfileView', error);\n    profileContainerEl.innerHTML = '<div class=\"empty-state\" style=\"padding: 40px 20px; text-align: center;\"><i class=\"ph ph-warning-circle\" style=\"font-size: 48px; opacity: 0.5; color: #ef4444;\"></i><p>Failed to load profile</p></div>';\n  }\n}\n\n/**\n * Load Settings View\n */\nasync function loadSettingsView() {\n  const settingsContainerEl = document.getElementById('settings-form-container');\n  if (!settingsContainerEl) return;\n\n  // Render form\n  settingsContainerEl.innerHTML = `\n    <div style=\"max-width: 600px;\">\n      <h3 style=\"margin: 0 0 24px 0;\">Account Settings</h3>\n      \n      <div class=\"card\" style=\"padding: 20px; margin-bottom: 20px;\">\n        <h4 style=\"margin: 0 0 16px 0;\">Notifications</h4>\n        <label style=\"display: flex; align-items: center; cursor: pointer; margin-bottom: 12px;\">\n          <input type=\"checkbox\" id=\"email-notifications\" checked style=\"margin-right: 12px; width: 18px; height: 18px;\">\n          <span>Email notifications (Verification updates)</span>\n        </label>\n        <label style=\"display: flex; align-items: center; cursor: pointer; margin-bottom: 12px;\">\n          <input type=\"checkbox\" id=\"payment-notifications\" checked style=\"margin-right: 12px; width: 18px; height: 18px;\">\n          <span>Payment receipts</span>\n        </label>\n      </div>\n\n      <div class=\"card\" style=\"padding: 20px; margin-bottom: 20px;\">\n         <h4 style=\"margin: 0 0 16px 0;\">Privacy</h4>\n         <label style=\"display: flex; align-items: center; cursor: pointer; margin-bottom: 12px;\">\n            <input type=\"checkbox\" id=\"profile-visibility\" style=\"margin-right: 12px;\">\n            <span>Profile Visibility (Public)</span>\n         </label>\n         <label style=\"display: flex; align-items: center; cursor: pointer;\">\n            <input type=\"checkbox\" id=\"analytics-tracking\" checked style=\"margin-right: 12px;\">\n            <span>Allow Analytics</span>\n         </label>\n      </div>\n\n      <div class=\"card\" style=\"padding: 20px; margin-bottom: 20px;\">\n        <h4 style=\"margin: 0 0 16px 0;\">Security</h4>\n        <button class=\"btn btn-secondary btn-sm\" onclick=\"window.location.href='/auth/password-reset'\">\n          <i class=\"ph ph-lock\"></i> Change Password\n        </button>\n        <div style=\"margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;\">\n             <button class=\"btn btn-danger btn-sm\" id=\"delete-account-btn\">Delete Account</button>\n        </div>\n      </div>\n\n      <div style=\"padding-top: 20px; border-top: 1px solid #e5e7eb;\">\n        <button id=\"save-settings-btn\" class=\"btn btn-primary\">\n          <i class=\"ph ph-floppy-disk\"></i> Save Settings\n        </button>\n      </div>\n    </div>`;\n\n  // Bind Events\n  document.getElementById('save-settings-btn')?.addEventListener('click', async () => {\n    const notifData = {\n      verification_alerts: document.getElementById('email-notifications').checked,\n      payment_receipts: document.getElementById('payment-notifications').checked\n    };\n    const privacyData = {\n      profile_visibility: document.getElementById('profile-visibility').checked,\n      analytics_tracking: document.getElementById('analytics-tracking').checked\n    };\n\n    try {\n      const btn = document.getElementById('save-settings-btn');\n      btn.innerHTML = '<div class=\"spinner-small\"></div> Saving...';\n      btn.disabled = true;\n\n      await Promise.all([\n        api.saveSettings('notifications', notifData),\n        api.saveSettings('privacy', privacyData)\n      ]);\n      showToast('Settings saved successfully', 'success');\n    } catch (e) {\n      showToast(e.message, 'error');\n      logError('saveSettings', e);\n    } finally {\n      const btn = document.getElementById('save-settings-btn');\n      if (btn) {\n        btn.innerHTML = '<i class=\"ph ph-floppy-disk\"></i> Save Settings';\n        btn.disabled = false;\n      }\n    }\n  });\n\n  document.getElementById('delete-account-btn')?.addEventListener('click', () => {\n    const pwd = prompt(\"Enter your password to confirm deletion:\");\n    if (pwd) {\n      api.deleteAccount(pwd).then(() => {\n        alert('Account deleted.');\n        window.location.href = '/auth/register';\n      }).catch(err => showToast(err.message, 'error'));\n    }\n  });\n}\n\n/**\n * Setup Credit Handlers (Modal & Payment)\n */\nfunction setupCreditHandlers() {\n  const modal = document.getElementById('credits-modal');\n  const openBtns = [document.getElementById('quick-credits-btn'), document.getElementById('add-credits-btn')];\n  const closeBtns = [document.getElementById('credits-close-btn'), document.getElementById('credits-cancel-btn')];\n  const proceedBtn = document.getElementById('credits-proceed-btn');\n  const customInput = document.getElementById('credit-amount');\n  const packages = document.querySelectorAll('.package');\n\n  let selectedAmount = 0;\n\n  function openModal() {\n    if (modal) modal.classList.add('show');\n  }\n\n  function closeModal() {\n    if (modal) modal.classList.remove('show');\n    packages.forEach(p => p.classList.remove('selected'));\n    if (customInput) customInput.value = '';\n    selectedAmount = 0;\n  }\n\n  openBtns.forEach(btn => btn?.addEventListener('click', openModal));\n  closeBtns.forEach(btn => btn?.addEventListener('click', closeModal));\n\n  packages.forEach(pkg => {\n    pkg.addEventListener('click', () => {\n      packages.forEach(p => p.classList.remove('selected'));\n      pkg.classList.add('selected');\n      selectedAmount = parseFloat(pkg.dataset.amount);\n      if (customInput) customInput.value = '';\n    });\n  });\n\n  customInput?.addEventListener('input', () => {\n    packages.forEach(p => p.classList.remove('selected'));\n    selectedAmount = parseFloat(customInput.value);\n  });\n\n  proceedBtn?.addEventListener('click', async () => {\n    if (!selectedAmount || selectedAmount < 1) {\n      showToast('Please select an amount (minimum $1)', 'warning');\n      return;\n    }\n\n    try {\n      const originalText = proceedBtn.innerHTML;\n      proceedBtn.innerHTML = '<div class=\"spinner-small\"></div> Processing...';\n      proceedBtn.disabled = true;\n\n      const result = await api.initializePayment(selectedAmount);\n      if (result.authorization_url) {\n        window.location.href = result.authorization_url;\n      } else {\n        throw new Error('No payment URL returned');\n      }\n    } catch (e) {\n      showToast(e.message, 'error');\n      proceedBtn.disabled = false;\n      proceedBtn.innerHTML = 'Proceed to Payment';\n    }\n  });\n}\n\n/**\n * Setup Rental Handlers (placeholder for future implementation)\n */\nfunction setupRentalHandlers() {\n  // Placeholder for rental-specific event handlers\n  console.log('Rental handlers initialized');\n}\n\n/**\n * Load Recent Activity\n */\nasync function loadRecentActivity() {\n  const activityListEl = document.getElementById('recent-activity-list');\n  if (!activityListEl) return;\n\n  try {\n    const response = await fetch('/api/dashboard/activity/recent', {\n      headers: {\n        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,\n        'Cache-Control': 'no-cache'\n      }\n    });\n\n    if (response.status === 401) {\n      // Silent fail on 401 - auth-check.js will handle redirect\n      return;\n    }\n\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n    const data = await response.json();\n    const activities = data.activities || data || [];\n\n    if (activities.length === 0) {\n      activityListEl.innerHTML = '<div class=\"empty-state\" style=\"padding: 40px 20px; text-align: center; color: #6b7280;\">No recent activity</div>';\n    } else {\n      activityListEl.innerHTML = activities.slice(0, 5).map(a => `\n        <div class=\"activity-item\" style=\"padding: 12px; border-bottom: 1px solid #e5e7eb;\">\n          <div style=\"font-weight: 500;\">${escapeHtml(a.description || 'Activity')}</div>\n          <div style=\"font-size: 13px; color: #6b7280;\">${formatDate(a.created_at)}</div>\n        </div>\n      `).join('');\n    }\n  } catch (error) {\n    if (error.name !== 'AbortError') {\n      logError('loadRecentActivity', error);\n    }\n  }\n}\n\n// Export for testing\nexport { loadAreaCodes, loadServices, updatePricing, purchaseVerification, setupCreditHandlers, setupRentalHandlers, loadRecentActivity };\n"],"names":["stateManager","constructor","this","state","user","balance","currentView","verification","step","areaCode","service","carrier","cost","verificationId","pollingInterval","areaCodes","services","carriers","listeners","setState","updates","notify","subscribe","listener","push","unsubscribe","filter","l","forEach","getState","api","getCountries","response","fetch","ok","Error","status","json","error","getAreaCodes","getServices","params","URLSearchParams","getCarriers","getPricing","area_code","purchaseVerification","method","headers","body","JSON","stringify","initializePayment","amount_usd","err","detail","saveSettings","type","data","logoutAll","e","deleteAccount","password","APIError","message","super","name","errorMessages","handleError","logError","context","validators","value","test","valid","validateVerification","errors","areaCodeValidation","serviceValidation","carrierValidation","Object","keys","length","showToast","toast","document","createElement","className","textContent","appendChild","setTimeout","remove","hideModals","querySelectorAll","modal","classList","style","overflow","escapeHtml","text","map","replace","m","formatDate","dateString","Date","toLocaleDateString","year","month","day","updateBalanceDisplay","formatted","toFixed","getElementById","el","showLoading","elementId","add","hideLoading","cache","ttl","Map","set","key","expires","now","get","item","delete","clear","has","events","eventBus","on","event","callback","emit","off","callbacks","index","indexOf","splice","init","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","sidebarToggle","addEventListener","toggleSidebar","userAvatarBtn","toggleUserDropdown","dropdown","avatarBtn","contains","target","handleLogout","openVerificationModal","closeVerificationModal","goToVerificationStep","onAreaCodeChange","onServiceChange","onCarrierChange","window","loadBalance","openBtns","closeBtns","proceedBtn","customInput","packages","selectedAmount","openModal","closeModal","p","btn","pkg","parseFloat","dataset","amount","async","innerHTML","disabled","result","authorization_url","location","href","setupCreditHandlers","setupEventListeners","loadUserData","navigator","onLine","urlParams","search","switchView","preventDefault","targetView","getAttribute","view","url","history","pushState","updateURL","localStorage","getItem","setupViewSwitching","activityListEl","Authorization","activities","slice","a","description","created_at","join","loadRecentActivity","catch","sidebar","toggle","setItem","controller","AbortController","timeoutId","abort","signal","clearTimeout","statusText","emailEl","initialsEl","email","initials","charAt","toUpperCase","confirm","credits","viewName","v","rentalsListEl","rentals","r","phone_number","service_name","loadRentalsView","transactionsListEl","transactions","tx","Math","abs","loadWalletView","profileContainerEl","credentials","id","loadProfileView","settingsContainerEl","notifData","verification_alerts","checked","payment_receipts","privacyData","profile_visibility","analytics_tracking","Promise","all","pwd","prompt","then","alert","loadSettingsView","cached","success","select","tierManager","checkFeatureAccess","lockFeature","parentElement","area_codes","code","option","loadAreaCodes","loadCarriers","clearInterval","cacheKey","loadServices","updatePricing","pricing","base_price","area_code_premium","carrier_premium","total_price","s","parseInt","display","stepEl","validation","values"],"mappings":"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"}