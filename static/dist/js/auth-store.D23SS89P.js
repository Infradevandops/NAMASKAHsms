import{S as e,T as t}from"./constants.mniaqQLw.js";function n(e,t){let n;try{n=e()}catch(r){return}return{getItem:e=>{var t;const r=e=>null===e?null:JSON.parse(e,void 0),o=null!=(t=n.getItem(e))?t:null;return o instanceof Promise?o.then(r):r(o)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}const r=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>r(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>r(e)(n)}}},o=(e=>{let t;const n=new Set,r=(e,r)=>{const o="function"==typeof e?e(t):e;if(!Object.is(o,t)){const e=t;t=(null!=r?r:"object"!=typeof o||null===o)?o:Object.assign({},t,o),n.forEach(n=>n(t,e))}},o=()=>t,s={setState:r,getState:o,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e))},a=t=e(r,o,s);return s})(((e,t)=>(o,s,a)=>{let i={storage:n(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},c=!1,l=0;const u=new Set,g=new Set;let h=i.storage;if(!h)return e((...e)=>{o(...e)},s,a);const d=()=>{const e=i.partialize({...s()});return h.setItem(i.name,{state:e,version:i.version})},f=a.setState;a.setState=(e,t)=>(f(e,t),d());const m=e((...e)=>(o(...e),d()),s,a);let S;a.getInitialState=()=>m;const E=()=>{var e,t;if(!h)return;const n=++l;c=!1,u.forEach(e=>{var t;return e(null!=(t=s())?t:m)});const a=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=s())?e:m))||void 0;return r(h.getItem.bind(h))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const t=i.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;if(n!==l)return;const[r,a]=e;return S=i.merge(a,null!=(t=s())?t:m),o(S,!0),r?d():void 0}).then(()=>{n===l&&(null==a||a(S,void 0),S=s(),c=!0,g.forEach(e=>e(S)))}).catch(e=>{n===l&&(null==a||a(void 0,e))})};return a.persist={setOptions:e=>{i={...i,...e},e.storage&&(h=e.storage)},clearStorage:()=>{null==h||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>E(),hasHydrated:()=>c,onHydrate:e=>(u.add(e),()=>{u.delete(e)}),onFinishHydration:e=>(g.add(e),()=>{g.delete(e)})},i.skipHydration||E(),S||m})(e=>({accessToken:null,refreshToken:null,user:null,isAuthenticated:!1,isLoading:!1,error:null,setTokens:(t,n)=>e({accessToken:t,refreshToken:n||null,isAuthenticated:!0,error:null}),setUser:t=>e({user:t,isLoading:!1}),logout:()=>e({accessToken:null,refreshToken:null,user:null,isAuthenticated:!1,error:null}),setError:t=>e({error:t,isLoading:!1}),setLoading:()=>e({isLoading:!0})}),{name:"auth-storage",storage:n(()=>localStorage)}));function s(){const t=o.getState();return t.accessToken?t.accessToken:localStorage.getItem(e.ACCESS_TOKEN)}function a(){const e=s();return!!(e&&e.length>0)}function i(){const e=s();return e?{Authorization:`Bearer ${e}`}:{}}function c(t,n,r){if(o.getState().setTokens(t,n),r){const t=Date.now()+1e3*r;localStorage.setItem(e.TOKEN_EXPIRES,t.toString())}}function l(){o.getState().logout(),localStorage.removeItem(e.TOKEN_EXPIRES)}function u(){const t=localStorage.getItem(e.TOKEN_EXPIRES);return!!t&&Date.now()>parseInt(t,10)}function g(){const n=localStorage.getItem(e.TOKEN_EXPIRES);if(!n)return!1;const r=parseInt(n,10);return Date.now()+t.TOKEN_REFRESH_BUFFER>r}function h(){return o.getState().refreshToken||localStorage.getItem(e.REFRESH_TOKEN)}function d(e){l();const t=e?`/auth/login?return=${encodeURIComponent(e)}`:"/auth/login";window.location.href=t}function f(){const e=window.location.pathname;return!["/","/landing","/auth/","/login","/register","/pricing","/about","/contact"].some(t=>e===t||e.startsWith(t))}"undefined"!=typeof window&&(window.AuthHelpers={getAuthToken:s,hasAuthToken:a,getAuthHeaders:i,setAuthTokens:c,clearAuth:l,isTokenExpired:u,shouldRefreshToken:g,getRefreshToken:h,redirectToLogin:d,isProtectedPage:f});export{s as a,g as b,l as c,h as d,f as e,i as g,a as h,u as i,d as r,c as s};
//# sourceMappingURL=auth-store.D23SS89P.js.map
