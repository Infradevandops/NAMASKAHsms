{"version":3,"file":"tier-card.Qu4WmpSt.js","sources":["../../js/tier-card.js"],"sourcesContent":["/**\n * Tier Card Module\n * Handles tier display, loading states, and CTA buttons\n * \n * Extracted from inline dashboard.html script for:\n * - Better cacheability\n * - Testability\n * - Maintainability\n */\n\nimport {\n    TIMEOUTS,\n    STATES,\n    ENDPOINTS,\n    TIER_DISPLAY_NAMES,\n    TIER_BADGE_CLASSES,\n    TIER_FEATURES,\n    TIER_CTA_CONFIG,\n    STORAGE_KEYS\n} from './constants.js';\nimport { hasAuthToken, getAuthHeaders } from './auth-helpers.ts';\n\n/**\n * TierCard class - manages the tier card widget\n */\nexport class TierCard {\n    constructor(containerId, options = {}) {\n        this.containerId = containerId;\n        this.container = document.getElementById(containerId);\n\n        if (!this.container) {\n            console.error(`TierCard: Container #${containerId} not found`);\n            return;\n        }\n\n        // Configuration\n        this.timeout = options.timeout || TIMEOUTS.API_REQUEST;\n        this.failsafeTimeout = options.failsafeTimeout || TIMEOUTS.FAILSAFE;\n        this.refreshInterval = options.refreshInterval || TIMEOUTS.REFRESH_INTERVAL;\n        this.onStateChange = options.onStateChange || null;\n\n        // State\n        this.state = STATES.INITIAL;\n        this.currentData = null;\n        this.abortController = null;\n        this.timeoutId = null;\n        this.failsafeId = null;\n        this.refreshIntervalId = null;\n\n        // Element references\n        this.elements = {\n            tierName: document.getElementById('tier-name'),\n            tierPrice: document.getElementById('tier-price'),\n            featuresList: document.getElementById('tier-features-list'),\n            ctaButtons: {\n                upgrade: document.getElementById('upgrade-btn'),\n                compare: document.getElementById('compare-plans-btn'),\n                addCredits: document.getElementById('add-credits-btn'),\n                usage: document.getElementById('usage-btn'),\n                manage: document.getElementById('manage-btn'),\n                contact: document.getElementById('contact-btn')\n            }\n        };\n\n        // Bind methods\n        this.load = this.load.bind(this);\n        this.retry = this.retry.bind(this);\n    }\n\n    /**\n     * Initialize the tier card\n     */\n    init() {\n        this.load();\n        this.startAutoRefresh();\n        this.setupFailsafe();\n    }\n\n    /**\n     * Set up failsafe timeout\n     */\n    setupFailsafe() {\n        this.failsafeId = setTimeout(() => {\n            if (this.state === STATES.LOADING) {\n                this._log('warn', `Failsafe triggered after ${this.failsafeTimeout}ms`);\n                this.setState(STATES.TIMEOUT);\n            }\n        }, this.failsafeTimeout);\n    }\n\n    /**\n     * Start auto-refresh interval\n     */\n    startAutoRefresh() {\n        if (this.refreshIntervalId) {\n            clearInterval(this.refreshIntervalId);\n        }\n\n        this.refreshIntervalId = setInterval(() => {\n            if (hasAuthToken()) {\n                this.load();\n            }\n        }, this.refreshInterval);\n    }\n\n    /**\n     * Stop auto-refresh\n     */\n    stopAutoRefresh() {\n        if (this.refreshIntervalId) {\n            clearInterval(this.refreshIntervalId);\n            this.refreshIntervalId = null;\n        }\n    }\n\n    /**\n     * Load tier information\n     */\n    async load() {\n        this._log('info', 'Loading tier information...');\n\n        // Clear previous timers\n        this._clearTimers();\n\n        // Check authentication\n        if (!hasAuthToken()) {\n            this._log('warn', 'No auth token found');\n            this.setState(STATES.UNAUTHENTICATED);\n            return;\n        }\n\n        this.setState(STATES.LOADING);\n\n        // Create abort controller for timeout\n        this.abortController = new AbortController();\n\n        // Set request timeout\n        this.timeoutId = setTimeout(() => {\n            this._log('warn', `Request timeout after ${this.timeout}ms`);\n            this.abortController.abort();\n            this.setState(STATES.TIMEOUT);\n        }, this.timeout);\n\n        try {\n            this._log('info', `API Call: GET ${ENDPOINTS.TIERS.CURRENT}`);\n\n            const response = await fetch(ENDPOINTS.TIERS.CURRENT, {\n                credentials: 'include',\n                headers: getAuthHeaders(),\n                signal: this.abortController.signal\n            });\n\n            this._clearTimers();\n            this._log('info', `API Response: ${response.status}`);\n\n            // Handle 401 Unauthorized\n            if (response.status === 401) {\n                this._log('warn', '401 Unauthorized - session may have expired');\n                this.setState(STATES.SESSION_EXPIRED);\n                return;\n            }\n\n            // Handle other errors\n            if (!response.ok) {\n                throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n            }\n\n            // Parse response\n            const data = await response.json();\n            this.currentData = data;\n\n            // Cache data for fallback\n            this._cacheData(data);\n\n            this._log('info', 'Tier loaded successfully', { tier: data.current_tier });\n            this.setState(STATES.LOADED, data);\n\n        } catch (error) {\n            this._clearTimers();\n\n            // Ignore abort errors (handled by timeout)\n            if (error.name === 'AbortError') {\n                return;\n            }\n\n            this._log('error', 'Tier load failed', { error: error.message });\n\n            // Try cached data as fallback\n            const cachedData = this._getCachedData();\n            if (cachedData) {\n                this._log('info', 'Using cached tier data as fallback');\n                this.setState(STATES.LOADED, cachedData);\n                this._showCacheWarning();\n                return;\n            }\n\n            this.setState(STATES.ERROR, { message: error.message });\n        }\n    }\n\n    /**\n     * Retry loading\n     */\n    retry() {\n        this.load();\n    }\n\n    /**\n     * Set the current state and update UI\n     */\n    setState(state, data = null) {\n        this.state = state;\n\n        // Update container classes\n        this.container.classList.remove(\n            'tier-card-loading',\n            'tier-card-error',\n            'tier-card-loaded'\n        );\n\n        // Update aria attributes\n        this.container.setAttribute('aria-busy', state === STATES.LOADING ? 'true' : 'false');\n\n        switch (state) {\n            case STATES.LOADING:\n                this.container.classList.add('tier-card-loading');\n                this._renderLoading();\n                break;\n\n            case STATES.UNAUTHENTICATED:\n                this.container.classList.add('tier-card-error');\n                this._renderUnauthenticated();\n                break;\n\n            case STATES.SESSION_EXPIRED:\n                this.container.classList.add('tier-card-error');\n                this._renderSessionExpired();\n                break;\n\n            case STATES.TIMEOUT:\n                this.container.classList.add('tier-card-error');\n                this._renderTimeout();\n                break;\n\n            case STATES.ERROR:\n                this.container.classList.add('tier-card-error');\n                this._renderError(data?.message);\n                break;\n\n            case STATES.LOADED:\n                this.container.classList.add('tier-card-loaded');\n                this._renderLoaded(data);\n                break;\n        }\n\n        // Call state change callback\n        if (this.onStateChange) {\n            this.onStateChange(state, data);\n        }\n    }\n\n    /**\n     * Render loading state\n     */\n    _renderLoading() {\n        this.elements.tierName.innerHTML = '<span class=\"loading-spinner\"></span> Loading...';\n        this.elements.tierPrice.textContent = '';\n        this.elements.featuresList.innerHTML = '';\n        this._hideAllCTAs();\n    }\n\n    /**\n     * Render unauthenticated state\n     */\n    _renderUnauthenticated() {\n        this.elements.tierName.innerHTML = 'üîí Not logged in';\n        this.elements.tierPrice.textContent = '';\n        this.elements.featuresList.innerHTML = `\n            <div style=\"margin-top: 12px;\">\n                <a href=\"/auth/login\" class=\"btn btn-primary\" aria-label=\"Log in to view your subscription plan\">\n                    Log in to view your plan\n                </a>\n            </div>\n        `;\n        this._hideAllCTAs();\n    }\n\n    /**\n     * Render session expired state\n     */\n    _renderSessionExpired() {\n        this.elements.tierName.innerHTML = 'üîê Session expired';\n        this.elements.tierPrice.textContent = '';\n        this.elements.featuresList.innerHTML = `\n            <div style=\"margin-top: 12px;\">\n                <a href=\"/auth/login\" class=\"btn btn-primary\" aria-label=\"Log in again to continue\">\n                    Log in again\n                </a>\n            </div>\n        `;\n        this._hideAllCTAs();\n    }\n\n    /**\n     * Render timeout state\n     */\n    _renderTimeout() {\n        this.elements.tierName.innerHTML = '‚è±Ô∏è Request timed out';\n        this.elements.tierPrice.textContent = '';\n        this.elements.featuresList.innerHTML = `\n            <div style=\"color: var(--text-muted); margin-bottom: 12px;\">\n                The server took too long to respond.\n            </div>\n            <button class=\"btn btn-secondary\" onclick=\"window.tierCard?.retry()\" aria-label=\"Try loading tier information again\">\n                üîÑ Try again\n            </button>\n        `;\n        this._hideAllCTAs();\n    }\n\n    /**\n     * Render error state\n     */\n    _renderError(message) {\n        const errorMsg = message || 'Unable to load plan information';\n        this.elements.tierName.innerHTML = '‚ö†Ô∏è Error';\n        this.elements.tierPrice.textContent = '';\n        this.elements.featuresList.innerHTML = `\n            <div style=\"color: var(--text-muted); margin-bottom: 12px;\">\n                ${this._escapeHtml(errorMsg)}\n            </div>\n            <button class=\"btn btn-secondary\" onclick=\"window.tierCard?.retry()\" aria-label=\"Retry loading tier information\">\n                üîÑ Retry\n            </button>\n        `;\n        // Show upgrade button as fallback action\n        if (this.elements.ctaButtons.upgrade) {\n            this.elements.ctaButtons.upgrade.style.display = 'inline-flex';\n        }\n    }\n\n    /**\n     * Render loaded state with tier data\n     */\n    _renderLoaded(data) {\n        const tierCode = data.current_tier || 'freemium';\n        const tierName = TIER_DISPLAY_NAMES[tierCode] || 'Unknown';\n        const badgeClass = TIER_BADGE_CLASSES[tierCode] || '';\n\n        // Render tier name with badge\n        this.elements.tierName.innerHTML = `\n            <span class=\"tier-badge ${badgeClass}\" style=\"font-size: 18px; padding: 6px 16px;\">\n                ${tierName}\n            </span>\n        `;\n\n        // Render price\n        if (data.price_monthly !== undefined) {\n            this.elements.tierPrice.textContent = data.price_monthly === 0\n                ? 'Free'\n                : `$${data.price_monthly}/month`;\n        }\n\n        // Render features\n        const features = TIER_FEATURES[tierCode] || [{ text: 'Basic features included', available: true }];\n        let featuresHtml = '';\n\n        for (const feature of features) {\n            const icon = feature.available ? '‚úì' : '‚úó';\n            const style = feature.available\n                ? 'color: var(--tier-freemium);'\n                : 'color: var(--text-muted);';\n            featuresHtml += `<div style=\"margin-bottom: 4px; ${style}\">${icon} ${feature.text}</div>`;\n        }\n\n        // Add quota info if available\n        if (data.quota_usd > 0) {\n            featuresHtml += `<div style=\"margin-bottom: 4px; color: var(--tier-freemium);\">‚úì $${data.quota_usd} monthly quota</div>`;\n        }\n\n        this.elements.featuresList.innerHTML = featuresHtml;\n\n        // Render CTAs\n        this._renderCTAs(tierCode);\n\n        // Show quota card if applicable\n        this._updateQuotaDisplay(tierCode, data);\n    }\n\n    /**\n     * Render CTA buttons based on tier\n     */\n    _renderCTAs(tierCode) {\n        const config = TIER_CTA_CONFIG[tierCode] || TIER_CTA_CONFIG.freemium;\n        this._hideAllCTAs();\n\n        for (const cta of config) {\n            const btn = this.elements.ctaButtons[cta.id.replace('-btn', '').replace('compare-plans', 'compare').replace('add-credits', 'addCredits')];\n            if (!btn) continue;\n\n            btn.style.display = 'inline-flex';\n            btn.className = `btn btn-${cta.variant}`;\n            btn.textContent = cta.label;\n            btn.setAttribute('aria-label', `${cta.label} - ${TIER_DISPLAY_NAMES[tierCode]} tier action`);\n\n            // Set click handler\n            if (cta.href) {\n                btn.onclick = () => { window.location.href = cta.href; };\n            } else if (cta.action && typeof window[cta.action] === 'function') {\n                btn.onclick = () => { window[cta.action](); };\n            }\n        }\n    }\n\n    /**\n     * Hide all CTA buttons\n     */\n    _hideAllCTAs() {\n        for (const btn of Object.values(this.elements.ctaButtons)) {\n            if (btn) btn.style.display = 'none';\n        }\n    }\n\n    /**\n     * Update quota display\n     */\n    _updateQuotaDisplay(tierCode, data) {\n        const quotaCard = document.getElementById('quota-card');\n        const apiStatsCard = document.getElementById('api-stats-card');\n\n        if (tierCode !== 'freemium' && data.quota_usd > 0 && quotaCard) {\n            quotaCard.style.display = 'block';\n\n            const quotaUsed = data.quota_used_usd || 0;\n            const quotaLimit = data.quota_usd || 0;\n            const percentage = quotaLimit > 0 ? Math.min((quotaUsed / quotaLimit) * 100, 100) : 0;\n\n            const quotaFill = document.getElementById('quota-fill');\n            const quotaText = document.getElementById('quota-text');\n\n            if (quotaFill) {\n                quotaFill.style.width = `${percentage}%`;\n                quotaFill.style.background = percentage >= 100 ? '#ef4444'\n                    : percentage > 80 ? '#f59e0b'\n                        : 'var(--primary)';\n            }\n\n            if (quotaText) {\n                quotaText.textContent = `$${quotaUsed.toFixed(2)} / $${quotaLimit.toFixed(2)}`;\n            }\n        }\n\n        if (tierCode !== 'freemium' && apiStatsCard) {\n            apiStatsCard.style.display = 'block';\n\n            const smsCount = document.getElementById('api-sms-count');\n            const apiCalls = document.getElementById('api-calls-count');\n            const apiKeys = document.getElementById('api-keys-count');\n\n            if (smsCount) smsCount.textContent = data.sms_count || 0;\n            if (apiCalls) apiCalls.textContent = data.sms_count || 0;\n            if (apiKeys) apiKeys.textContent = data.features?.api_key_limit || 0;\n        }\n    }\n\n    /**\n     * Show cache warning indicator\n     */\n    _showCacheWarning() {\n        const warning = document.createElement('div');\n        warning.style.cssText = 'color: var(--tier-pro); font-size: 12px; margin-top: 8px;';\n        warning.textContent = '‚ö†Ô∏è Showing cached data';\n        this.elements.featuresList.appendChild(warning);\n    }\n\n    /**\n     * Cache tier data to localStorage\n     */\n    _cacheData(data) {\n        try {\n            localStorage.setItem(STORAGE_KEYS.CACHED_TIER, JSON.stringify(data));\n        } catch (e) {\n            // Ignore storage errors\n        }\n    }\n\n    /**\n     * Get cached tier data\n     */\n    _getCachedData() {\n        try {\n            const cached = localStorage.getItem(STORAGE_KEYS.CACHED_TIER);\n            return cached ? JSON.parse(cached) : null;\n        } catch (e) {\n            return null;\n        }\n    }\n\n    /**\n     * Clear all timers\n     */\n    _clearTimers() {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n            this.timeoutId = null;\n        }\n        if (this.failsafeId) {\n            clearTimeout(this.failsafeId);\n            this.failsafeId = null;\n        }\n    }\n\n    /**\n     * Escape HTML to prevent XSS\n     */\n    _escapeHtml(text) {\n        if (!text) return '';\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    /**\n     * Log helper\n     */\n    _log(level, message, data = null) {\n        if (window.FrontendLogger) {\n            window.FrontendLogger[level](message, data);\n        } else {\n            console[level === 'error' ? 'error' : level === 'warn' ? 'warn' : 'log'](\n                `[TierCard] ${message}`,\n                data || ''\n            );\n        }\n    }\n\n    /**\n     * Destroy the tier card instance\n     */\n    destroy() {\n        this._clearTimers();\n        this.stopAutoRefresh();\n\n        if (this.abortController) {\n            this.abortController.abort();\n        }\n    }\n}\n\n// Factory function for easy initialization\nexport function initTierCard(containerId = 'tier-card', options = {}) {\n    const tierCard = new TierCard(containerId, options);\n    tierCard.init();\n\n    // Expose globally for onclick handlers\n    window.tierCard = tierCard;\n\n    return tierCard;\n}\n\n// For non-module scripts (IIFE compatibility)\nif (typeof window !== 'undefined') {\n    window.TierCard = TierCard;\n    window.initTierCard = initTierCard;\n}\n"],"names":["TierCard","constructor","containerId","options","this","container","document","getElementById","timeout","TIMEOUTS","API_REQUEST","failsafeTimeout","FAILSAFE","refreshInterval","REFRESH_INTERVAL","onStateChange","state","STATES","INITIAL","currentData","abortController","timeoutId","failsafeId","refreshIntervalId","elements","tierName","tierPrice","featuresList","ctaButtons","upgrade","compare","addCredits","usage","manage","contact","load","bind","retry","init","startAutoRefresh","setupFailsafe","setTimeout","LOADING","_log","setState","TIMEOUT","clearInterval","setInterval","hasAuthToken","stopAutoRefresh","_clearTimers","UNAUTHENTICATED","AbortController","abort","ENDPOINTS","TIERS","CURRENT","response","fetch","credentials","headers","getAuthHeaders","signal","status","SESSION_EXPIRED","ok","Error","statusText","data","json","_cacheData","tier","current_tier","LOADED","error","name","message","cachedData","_getCachedData","_showCacheWarning","ERROR","classList","remove","setAttribute","add","_renderLoading","_renderUnauthenticated","_renderSessionExpired","_renderTimeout","_renderError","_renderLoaded","innerHTML","textContent","_hideAllCTAs","errorMsg","_escapeHtml","style","display","tierCode","TIER_DISPLAY_NAMES","badgeClass","TIER_BADGE_CLASSES","price_monthly","features","TIER_FEATURES","text","available","featuresHtml","feature","icon","quota_usd","_renderCTAs","_updateQuotaDisplay","config","TIER_CTA_CONFIG","freemium","cta","btn","id","replace","className","variant","label","href","onclick","window","location","action","Object","values","quotaCard","apiStatsCard","quotaUsed","quota_used_usd","quotaLimit","percentage","Math","min","quotaFill","quotaText","width","background","toFixed","smsCount","apiCalls","apiKeys","sms_count","_a","api_key_limit","warning","createElement","cssText","appendChild","localStorage","setItem","STORAGE_KEYS","CACHED_TIER","JSON","stringify","e","cached","getItem","parse","clearTimeout","div","level","FrontendLogger","destroy","initTierCard","tierCard"],"mappings":"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"}