!function(t){const o={timeout:1e4,failsafeTimeout:15e3,retryAttempts:3,retryDelay:1e3,loadingText:"Loading...",errorText:"Unable to load",timeoutText:"Request timed out",unauthText:"Not logged in",sessionExpiredText:"Session expired"},e={INITIAL:"initial",LOADING:"loading",LOADED:"loaded",ERROR:"error",TIMEOUT:"timeout",UNAUTHENTICATED:"unauthenticated",SESSION_EXPIRED:"session-expired"};function s(){const t=localStorage.getItem("access_token");return t&&t.length>0}function i(){const t=localStorage.getItem("access_token");return t?{Authorization:"Bearer "+t}:{}}t.DashboardLoader=class{constructor(t){if(this.options={...o,...t},this.state=e.INITIAL,this.abortController=null,this.timeoutId=null,this.failsafeId=null,this.retryCount=0,!this.options.containerId)throw new Error("DashboardLoader: containerId is required");if(!this.options.onLoad)throw new Error("DashboardLoader: onLoad function is required")}getContainer(){return document.getElementById(this.options.containerId)}setState(o,s=null){this.state=o;const i=this.getContainer();if(!i)return;Object.values(e).forEach(t=>{i.classList.remove(`loader-state-${t}`)}),i.classList.add(`loader-state-${o}`);const r=this.options[`on${o.charAt(0).toUpperCase()+o.slice(1)}`];"function"==typeof r&&r(s),t.FrontendLogger&&FrontendLogger.info(`[${this.options.containerId}] State: ${o}`,s)}showLoading(){this.setState(e.LOADING),this.options.renderLoading&&this.options.renderLoading()}showError(t){this.setState(e.ERROR,{error:t}),this.options.renderError&&this.options.renderError(t,()=>this.load())}showTimeout(){this.setState(e.TIMEOUT),this.options.renderTimeout&&this.options.renderTimeout(()=>this.load())}showUnauthenticated(){this.setState(e.UNAUTHENTICATED),this.options.renderUnauthenticated&&this.options.renderUnauthenticated()}showSessionExpired(){this.setState(e.SESSION_EXPIRED),this.options.renderSessionExpired&&this.options.renderSessionExpired()}clearTimers(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.failsafeId&&(clearTimeout(this.failsafeId),this.failsafeId=null)}abort(){this.abortController&&(this.abortController.abort(),this.abortController=null),this.clearTimers()}async load(){if(this.abort(),!1===this.options.requiresAuth||s()){this.showLoading(),this.abortController=new AbortController,this.timeoutId=setTimeout(()=>{t.FrontendLogger&&FrontendLogger.warn(`[${this.options.containerId}] Timeout after ${this.options.timeout}ms`),this.abort(),this.showTimeout()},this.options.timeout),this.failsafeId=setTimeout(()=>{this.state===e.LOADING&&(t.FrontendLogger&&FrontendLogger.error(`[${this.options.containerId}] Failsafe triggered after ${this.options.failsafeTimeout}ms`),this.abort(),this.showTimeout())},this.options.failsafeTimeout);try{const t=await this.options.onLoad({signal:this.abortController.signal,headers:i()});if(this.clearTimers(),t&&401===t.status)return void this.showSessionExpired();this.setState(e.LOADED,t),this.options.onSuccess&&this.options.onSuccess(t),this.retryCount=0}catch(o){if(this.clearTimers(),"AbortError"===o.name)return;if(t.FrontendLogger&&FrontendLogger.error(`[${this.options.containerId}] Load failed`,{error:o.message}),this.options.getCachedData){const t=this.options.getCachedData();if(t)return this.setState(e.LOADED,t),void(this.options.onSuccess&&this.options.onSuccess(t,{fromCache:!0}))}this.showError(o),this.options.onError&&this.options.onError(o)}}else this.showUnauthenticated()}retry(){this.retryCount++,this.retryCount<=this.options.retryAttempts?setTimeout(()=>this.load(),this.options.retryDelay):this.showError(new Error("Max retry attempts reached"))}destroy(){this.abort(),this.state=e.INITIAL}},t.DashboardLoaderStates=e,t.hasAuthToken=s,t.getAuthHeaders=i}(window);
//# sourceMappingURL=dashboard-loader.DstIMoaK.js.map
