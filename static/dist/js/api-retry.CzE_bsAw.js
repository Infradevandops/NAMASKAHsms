import{T as t,H as e}from"./constants.mniaqQLw.js";const n={maxRetries:3,baseDelay:1e3,maxDelay:t.API_REQUEST,backoffMultiplier:2};function r(t,e=n){const r=e.baseDelay*Math.pow(e.backoffMultiplier,t);return Math.min(r,e.maxDelay)}function a(t){return new Promise(e=>setTimeout(e,t))}async function s(t,s={},o={}){const i={...n,...o};let l;for(let n=0;n<=i.maxRetries;n++)try{if(n>0){const e=r(n-1,i);c("info",`Retry attempt ${n}/${i.maxRetries} for ${t}, waiting ${e}ms`),await a(e)}const o=await fetch(t,s);if(o.status>=400&&o.status<500&&o.status!==e.TIMEOUT&&o.status!==e.TOO_MANY_REQUESTS)return o;if(o.status>=500||o.status===e.TIMEOUT||o.status===e.TOO_MANY_REQUESTS){if(l=new Error(`HTTP ${o.status}`),n<i.maxRetries){c("warn",`Request failed with ${o.status}, will retry`,{url:t,attempt:n});continue}throw l}return o}catch(u){if(l=u,c("warn",`Request failed: ${u.message}, attempt ${n+1}/${i.maxRetries+1}`,{url:t}),n>=i.maxRetries)throw u}throw l}function o(t,e="Failed to load data"){const n=document.createElement("div");n.className="retry-container",n.style.cssText="text-align: center; padding: 20px; color: var(--text-muted);";const r=document.createElement("div");r.innerHTML="‚ö†Ô∏è",r.style.cssText="font-size: 32px; margin-bottom: 12px;",r.setAttribute("aria-hidden","true");const a=document.createElement("div");a.textContent=e,a.style.cssText="margin-bottom: 16px; color: var(--text-secondary);",a.setAttribute("role","alert");const s=document.createElement("button");return s.className="btn btn-secondary",s.innerHTML="üîÑ Retry",s.style.cssText="padding: 8px 16px; cursor: pointer;",s.setAttribute("aria-label","Retry loading data"),s.onclick=function(){s.disabled=!0,s.innerHTML='<span class="loading-spinner"></span> Retrying...',s.setAttribute("aria-busy","true"),Promise.resolve(t()).finally(()=>{s.disabled=!1,s.innerHTML="üîÑ Retry",s.setAttribute("aria-busy","false")})},n.appendChild(r),n.appendChild(a),n.appendChild(s),n}function i(t,e,n){const r="string"==typeof t?document.querySelector(t):t;r&&(r.innerHTML="",r.appendChild(o(e,n)))}function c(t,e,n=null){if("undefined"!=typeof window&&window.FrontendLogger)window.FrontendLogger[t](e,n);else{("error"===t?console.error:"warn"===t?console.warn:console.log)(`[ApiRetry] ${e}`,n||"")}}const l={fetchWithRetry:s,createRetryButton:o,showRetryUI:i,apiCall:async function(t){const{url:e,fetchOptions:n={credentials:"include"},container:r,onSuccess:a,onError:o,errorMessage:l="Failed to load data",retryConfig:u={}}=t,d=async()=>{try{const t=await s(e,n,u);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const r=await t.json();return a&&a(r,t),r}catch(t){throw c("error",`API call failed after retries: ${e}`,{error:t.message}),r&&i(r,d,l),o&&o(t),t}};return d()},config:n};"undefined"!=typeof window&&(window.ApiRetry=l);
//# sourceMappingURL=api-retry.CzE_bsAw.js.map
