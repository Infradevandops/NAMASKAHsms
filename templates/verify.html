{% extends "dashboard_base.html" %}

{% block page_title %}<span data-i18n="verify.title">SMS Verification</span>{% endblock %}
{% block page_subtitle %}<span data-i18n="verify.subtitle">Get instant SMS codes for any service</span>{% endblock %}

{% block content %}
<style>
    @keyframes pulse-ring {
        0% {
            transform: scale(0.33);
        }

        80%,
        100% {
            opacity: 0;
        }
    }

    @keyframes pulse-dot {
        0% {
            transform: scale(0.8);
        }

        50% {
            transform: scale(1);
        }

        100% {
            transform: scale(0.8);
        }
    }

    .pulse-container {
        display: inline-block;
        position: relative;
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
    }

    .pulse-ring {
        display: block;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 3px solid #3b82f6;
        box-sizing: border-box;
        animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        position: absolute;
        top: 0;
        left: 0;
    }

    .pulse-dot {
        display: block;
        width: 100%;
        height: 100%;
        background: #3b82f6;
        border-radius: 50%;
        animation: pulse-dot 1.25s cubic-bezier(0.455, 0.03, 0.515, 0.955) -0.4s infinite;
    }
</style>
<div style="max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 280px 1fr; gap: 20px;">

    <!-- Presets Sidebar (Tier 3+) -->
    <div class="card" style="padding: 20px; height: fit-content;" id="presets-card">
        <h3 style="font-size: 14px; margin-bottom: 12px; font-weight: 600; color: #4b5563;">
            <i class="fas fa-star" style="color: #f59e0b; margin-right: 6px;"></i>Quick Presets
        </h3>

        <div id="presets-list" style="margin-bottom: 16px;">
            <div
                style="font-size: 13px; color: #9ca3af; text-align: center; padding: 20px; background: #f9fafb; border-radius: 8px;">
                Loading presets...
            </div>
        </div>

        <div id="save-preset-ui" style="display: none; border-top: 1px solid #e5e7eb; padding-top: 12px;">
            <input type="text" id="preset-name-input" placeholder="Preset Name (e.g. US WhatsApp)"
                style="width: 100%; margin-bottom: 8px; font-size: 12px; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
            <button onclick="saveCurrentPreset()" class="btn"
                style="width: 100%; font-size: 12px; padding: 6px; background: #4b5563; color: white;">
                Save Current Selection
            </button>
        </div>

        <div id="preset-lock"
            style="display: none; padding: 15px; text-align: center; background: #f3f4f6; border-radius: 8px;">
            <div style="font-size: 24px; margin-bottom: 8px;">ðŸ”’</div>
            <p style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Upgrade to <b>Pro</b> to save and use
                efficiency presets.</p>
            <a href="/settings?tab=billing" class="btn"
                style="display: block; font-size: 11px; padding: 6px; background: #2563eb; color: white; text-decoration: none;">View
                Plans</a>
        </div>
    </div>

    <!-- Main Verification Interface -->
    <div>
        <div class="card" style="padding: 20px;">
            <h2 style="font-size: 16px; margin-bottom: 16px; font-weight: 600;" data-i18n="verify.title">Request SMS
                Code
            </h2>

            <div style="margin-bottom: 12px; position: relative;">
                <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600;"
                    data-i18n="verify.select_service">Service</label>
                <input type="text" id="service-search" placeholder="Search services (e.g., Telegram, WhatsApp)..."
                    autocomplete="off"
                    style="width: 100%; padding: 10px 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: all 0.2s;"
                    onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'"
                    onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'">
                <div id="service-dropdown"
                    style="display: none; position: absolute; background: white; border: 1px solid #e5e7eb; border-radius: 8px; max-height: 250px; overflow-y: auto; width: 100%; margin-top: 4px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); z-index: 100;">
                </div>
            </div>

            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600;"
                    data-i18n="verify.select_country">Country</label>
                <div id="country-field-wrapper">
                    <select id="country-select" onchange="onCountryChange()"
                        style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white;">
                        <option value="usa">ðŸ‡ºðŸ‡¸ United States</option>
                    </select>
                </div>
                <div id="country-lock"
                    style="display: none; padding: 10px; background: #eff6ff; border: 1px dashed #3b82f6; border-radius: 8px; font-size: 12px; color: #1e40af; margin-top: 4px;">
                    ðŸ”’ <a href="/settings?tab=billing"
                        style="color: #2563eb; font-weight: 700; text-decoration: none;">Upgrade to Starter</a> to
                    unlock
                    37+ other countries
                </div>
            </div>

            <!-- Premium Filtering Section -->
            <div id="premium-filters"
                style="margin-top: 20px; border-top: 1px solid #f3f4f6; padding-top: 15px; margin-bottom: 15px;">
                <div
                    style="font-size: 12px; font-weight: 700; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">
                    Premium Filtering</div>

                <!-- Area Code Selection (PAYG+) -->
                <div id="area-code-container" style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600;">Area
                        Code</label>
                    <div id="area-code-field-wrapper">
                        <input type="text" id="area-code-search" placeholder="Search city or area code..."
                            style="width: 100%; padding: 8px 12px; border: 1px solid #e5e7eb; border-top-left-radius: 8px; border-top-right-radius: 8px; font-size: 13px; border-bottom: none;"
                            aria-label="Search area code by city or number">
                        <select id="area-code-select"
                            style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; font-size: 14px; background: white;"
                            aria-label="Select area code">
                            <option value="">Any Area Code</option>
                        </select>
                    </div>
                    <div id="area-code-lock"
                        style="display: none; padding: 10px; background: #fff7ed; border: 1px dashed #fdba74; border-radius: 8px; font-size: 12px; color: #9a3412;">
                        ðŸ”’ <a href="/settings?tab=billing"
                            style="color: #ea580c; font-weight: 700; text-decoration: none;">Upgrade to Starter</a> to
                        select specific area codes
                    </div>
                </div>

                <!-- ISP/Carrier Selection (PRO+) -->
                <div id="carrier-container" style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600;">Carrier /
                        ISP</label>
                    <div id="carrier-field-wrapper">
                        <select id="carrier-select"
                            style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="">Any Carrier</option>
                        </select>
                    </div>
                    <div id="carrier-lock"
                        style="display: none; padding: 10px; background: #fff1f2; border: 1px dashed #fecdd3; border-radius: 8px; font-size: 12px; color: #9f1239;">
                        ðŸ”’ <a href="/settings?tab=billing"
                            style="color: #e11d48; font-weight: 700; text-decoration: none;">Upgrade to Pro</a> to
                        filter by
                        ISP/Carrier
                    </div>
                </div>
            </div>

            <div
                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px; padding: 12px; background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%); border-radius: 10px;">
                <div style="text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="service-cost">$0.00</div>
                    <div
                        style="font-size: 10px; color: #6366f1; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px;">
                        Cost</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: #10b981;">~30s</div>
                    <div
                        style="font-size: 10px; color: #059669; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px;">
                        Delivery</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: #f59e0b;">95%</div>
                    <div
                        style="font-size: 10px; color: #d97706; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px;">
                        Success</div>
                </div>
            </div>

            <button class="btn" id="purchase-btn" onclick="purchaseVerification()" disabled
                style="width: 100%; background: var(--primary); font-size: 14px; padding: 12px;"
                data-i18n="verify.buy_number">Continue</button>
        </div>

        <div class="card" id="reception-card" style="display: none; padding: 20px; margin-top: 16px;">
            <h2 style="font-size: 16px; margin-bottom: 16px; font-weight: 600;">SMS Reception</h2>

            <div id="phone-display"
                style="font-size: 18px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px; border-radius: 10px; margin-bottom: 16px; color: white; text-align: center; letter-spacing: 1px;">
            </div>

            <div
                style="background: #f0f9ff; border: 2px solid #bfdbfe; border-radius: 10px; padding: 20px; margin-bottom: 16px;">
                <div id="status-text"
                    style="font-size: 12px; color: #1e40af; margin-bottom: 10px; text-align: center; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                    Waiting for SMS</div>
                <div id="code-display"
                    style="font-size: 36px; font-weight: 700; color: #2563eb; letter-spacing: 4px; text-align: center; font-family: 'Courier New', monospace;">
                    ------</div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn" id="copy-btn" onclick="copyCode()"
                    style="flex: 1; display: none; background: #10b981; font-size: 14px; padding: 12px;">Copy
                    Code</button>
                <button class="btn" id="cancel-btn" onclick="cancelVerification()"
                    style="flex: 1; background: #ef4444; font-size: 14px; padding: 12px;">Cancel</button>
            </div>
        </div>
    </div>
    {% endblock %}

    {% block scripts %}
    {{ super() }}
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/static/js/verification.js"></script>
    {% endblock %}