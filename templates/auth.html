<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Authentication - Namaskah">
  <title>{% if form_type == 'login' %}Login{% elif form_type == 'register' %}Register{% elif form_type == 'password-reset' %}Reset Password{% else %}Verify Email{% endif %} - Namaskah</title>
  
  <link rel="stylesheet" href="/static/css/enterprise-premium.css">
  
  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .auth-container {
      width: 100%;
      max-width: 400px;
      padding: var(--space-lg);
    }
    
    .auth-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }
    
    .auth-header {
      text-align: center;
      margin-bottom: var(--space-xl);
    }
    
    .auth-header h1 {
      margin: 0 0 var(--space-sm) 0;
      font-size: 2rem;
      font-weight: 700;
      color: #1f2937;
    }
    
    .auth-header p {
      margin: 0;
      color: #6b7280;
    }
    
    .form-error {
      color: #dc2626;
      font-size: 0.95rem;
      margin-top: var(--space-md);
      margin-bottom: var(--space-md);
      font-weight: 600;
      padding: var(--space-md);
      background-color: #fee2e2;
      border-left: 4px solid #dc2626;
      border-radius: 4px;
      display: none;
    }
    
    .form-error:not(:empty) {
      display: block;
    }
    
    .form-group {
      margin-bottom: var(--space-lg);
    }
    
    .form-group label {
      display: block;
      margin-bottom: var(--space-sm);
      font-weight: 500;
      color: #111827;
    }
    
    .form-group input {
      width: 100%;
      padding: var(--space-md);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 1rem;
      transition: all 0.2s;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .form-group input.error {
      border-color: var(--danger);
    }
    
    .form-error {
      color: var(--danger);
      font-size: 0.875rem;
      margin-top: var(--space-sm);
    }
    
    .form-actions {
      display: flex;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }
    
    .form-actions button {
      flex: 1;
    }
    
    .auth-link {
      text-align: center;
      margin-top: var(--space-lg);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--border);
    }
    
    .auth-link a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    
    .auth-link a:hover {
      text-decoration: underline;
    }
    
    .password-strength {
      margin-top: var(--space-sm);
      height: 4px;
      background-color: var(--light);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .password-strength-bar {
      height: 100%;
      width: 0%;
      transition: width 0.3s, background-color 0.3s;
    }
    
    .password-strength-bar.weak {
      width: 25%;
      background-color: var(--danger);
    }
    
    .password-strength-bar.fair {
      width: 50%;
      background-color: var(--warning);
    }
    
    .password-strength-bar.good {
      width: 75%;
      background-color: #84cc16;
    }
    
    .password-strength-bar.strong {
      width: 100%;
      background-color: var(--success);
    }
    
    .alert {
      padding: var(--space-lg);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-lg);
    }
    
    .alert-success {
      background-color: #ecfdf5;
      border: 1px solid #d1fae5;
      color: #065f46;
    }
    
    .alert-error {
      background-color: #fef2f2;
      border: 1px solid #fee2e2;
      color: #7f1d1d;
    }
    
    .theme-toggle-auth {
      position: absolute;
      top: var(--space-lg);
      right: var(--space-lg);
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-base);
      z-index: 10;
    }
    
    .theme-toggle-auth:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    @media (max-width: 480px) {
      .auth-card {
        padding: var(--space-lg);
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .theme-toggle-auth {
        top: var(--space-md);
        right: var(--space-md);
      }
    }
  </style>
</head>
<body data-page="auth" data-form="{{ form_type or 'login' }}">
  <div class="auth-container">
    <button data-theme-toggle class="theme-toggle-auth" aria-label="Toggle theme">
      <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
    </button>
    <div class="auth-card">
      <!-- Login Form -->
      {% if form_type == 'login' or not form_type %}
      <div class="auth-header">
        <h1>Login</h1>
        <p>Sign in to your account</p>
      </div>
      
      <form id="login-form">
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required placeholder="you@example.com">
          <div class="form-error" id="email-error"></div>
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required placeholder="••••••••">
          <div class="form-error" id="password-error"></div>
        </div>
        
        <button type="submit" class="btn btn-primary btn-lg btn-block">
          Sign In
        </button>
        
        <div class="auth-link">
          <p>Don't have an account? <a href="/register">Register here</a></p>
          <p><a href="/password-reset">Forgot password?</a></p>
        </div>
      </form>
      {% endif %}
      
      <!-- Register Form -->
      {% if form_type == 'register' %}
      <div class="auth-header">
        <h1>Register</h1>
        <p>Create a new account</p>
      </div>
      
      <form id="register-form" method="POST" action="/api/auth/register">
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required placeholder="you@example.com">
          <div class="form-error" id="email-error"></div>
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required placeholder="••••••••">
          <div class="password-strength">
            <div class="password-strength-bar"></div>
          </div>
          <div class="form-error" id="password-error"></div>
        </div>
        
        <div class="form-group">
          <label for="confirm-password">Confirm Password</label>
          <input type="password" id="confirm-password" name="confirm_password" required placeholder="••••••••">
          <div class="form-error" id="confirm-password-error"></div>
        </div>
        
        <button type="submit" class="btn btn-primary btn-lg btn-block">
          Create Account
        </button>
        
        <div class="auth-link">
          <p>Already have an account? <a href="/login">Login here</a></p>
        </div>
      </form>
      {% endif %}
      
      <!-- Password Reset Form -->
      {% if form_type == 'password-reset' %}
      <div class="auth-header">
        <h1>Reset Password</h1>
        <p>Enter your email to reset your password</p>
      </div>
      
      <form id="password-reset-form" method="POST" action="/api/auth/password-reset">
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required placeholder="you@example.com">
          <div class="form-error" id="email-error"></div>
        </div>
        
        <button type="submit" class="btn btn-primary btn-lg btn-block">
          Send Reset Link
        </button>
        
        <div class="auth-link">
          <p><a href="/login">Back to login</a></p>
        </div>
      </form>
      {% endif %}
      
      <!-- Email Verify Form -->
      {% if form_type == 'email-verify' %}
      <div class="auth-header">
        <h1>Verify Email</h1>
        <p>Enter the code sent to your email</p>
      </div>
      
      <form id="email-verify-form" method="POST" action="/api/auth/verify-email">
        <div class="form-group">
          <label for="code">Verification Code</label>
          <input type="text" id="code" name="code" required placeholder="000000" maxlength="6">
          <div class="form-error" id="code-error"></div>
        </div>
        
        <button type="submit" class="btn btn-primary btn-lg btn-block">
          Verify Email
        </button>
        
        <div class="auth-link">
          <p><a href="/login">Back to login</a></p>
        </div>
      </form>
      {% endif %}
    </div>
  </div>
  
  <script src="/static/js/theme-manager.js"></script>
  <script>
    // Handle login form submission
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password })
        });
        
        if (response.ok) {
          const data = await response.json();
          // Store token and redirect
          localStorage.setItem('access_token', data.access_token);
          window.location.href = '/dashboard';
        } else {
          const error = await response.json();
          const errorMsg = error.detail || 'Login failed';
          document.getElementById('email-error').textContent = errorMsg;
          console.error('Login error:', errorMsg);
        }
      } catch (error) {
        document.getElementById('email-error').textContent = 'Network error: ' + error.message;
      }
    });
  </script>
  <script type="module" src="/static/js/main.js"></script>
</body>
</html>
