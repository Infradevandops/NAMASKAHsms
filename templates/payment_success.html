{% extends "public_base.html" %}

{% block public_content %}
<div style="max-width: 600px; margin: 80px auto; text-align: center;">
    <div style="font-size: 80px; margin-bottom: 24px;">âœ…</div>
    <h1 style="font-size: 32px; margin-bottom: 16px; color: #10b981;">Payment Successful!</h1>
    <p style="font-size: 18px; color: var(--text-muted); margin-bottom: 32px;">
        Your credits have been added to your account
    </p>
    
    <div style="background: var(--bg-card); border-radius: var(--radius-card); padding: 24px; box-shadow: var(--shadow-soft); margin-bottom: 32px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; text-align: left;">
            <div>
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Amount Paid</div>
                <div style="font-size: 24px; font-weight: 700;" id="amount-paid">$0.00</div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Credits Added</div>
                <div style="font-size: 24px; font-weight: 700; color: #10b981;" id="credits-added">$0.00</div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Transaction ID</div>
                <div style="font-size: 14px; font-family: monospace;" id="transaction-id">-</div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Date</div>
                <div style="font-size: 14px;" id="transaction-date">-</div>
            </div>
        </div>
    </div>
    
    <div style="display: flex; gap: 12px; justify-content: center;">
        <button class="btn" onclick="window.location.href='/dashboard'" style="padding: 12px 24px;">
            Go to Dashboard
        </button>
        <button class="btn" onclick="window.location.href='/verify'" style="padding: 12px 24px; background: #10b981;">
            Start Verification
        </button>
    </div>
    
    <p style="margin-top: 32px; font-size: 14px; color: var(--text-muted);">
        A receipt has been sent to your email
    </p>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const reference = urlParams.get('reference');
    
    if (reference) {
        try {
            const res = await fetch(`/api/billing/verify-payment/${reference}`);
            if (res.ok) {
                const data = await res.json();
                document.getElementById('amount-paid').textContent = `$${data.amount_usd || 0}`;
                document.getElementById('credits-added').textContent = `$${data.credits_added || 0}`;
                document.getElementById('transaction-id').textContent = reference;
                document.getElementById('transaction-date').textContent = new Date().toLocaleDateString();
            }
        } catch (error) {
            console.error('Failed to verify payment:', error);
        }
    }
    
    setTimeout(() => {
        window.location.href = '/dashboard';
    }, 10000);
});
</script>
{% endblock %}
